<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Aide-m√©moire Cron : workflows pratiques pour la planification de t√¢ches sous Linux.">
    <title>Cron & Planification - IT Cheatsheets</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body class="dark-theme text-slate-200">

    <header class="bg-slate-900/50 border-b border-white/5 py-8 px-4 relative overflow-hidden header-glow">
        <div class="max-w-4xl mx-auto relative z-10">
            <div class="flex items-center justify-between mb-4">
                <a href="../index.html" class="nav-back inline-flex items-center text-slate-400 hover:text-sky-400 transition">
                    <i class="fas fa-arrow-left mr-2"></i>Retour
                </a>
                <a href="../index.html" class="inline-flex items-center text-slate-400 hover:text-sky-400 transition">
                    <i class="fas fa-home mr-2"></i>Accueil
                </a>
            </div>
            <div class="text-center">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-xl bg-amber-500/20 mb-4 icon-glow">
                    <i class="fas fa-clock text-3xl text-amber-400"></i>
                </div>
                <h1 class="text-3xl font-bold mb-2 gradient-text">Cron & Planification</h1>
                <p class="text-slate-400">Workflows pratiques pour l'automatisation sous Linux</p>
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-4 relative z-10">
        <div class="mb-8 relative">
            <input type="text" id="searchInput" placeholder="Rechercher un workflow..."
                   class="search-dark w-full p-4 pl-12 rounded-lg outline-none transition">
            <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-500"></i>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="categoriesGrid"></div>
    </main>

    <div id="detailModal" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50 p-4 modal-overlay" onclick="closeModal(event)">
        <div class="modal-content-dark rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl modal-content" onclick="event.stopPropagation()">
            <div id="modalContent"></div>
        </div>
    </div>

    <footer class="border-t border-white/5 text-center text-slate-500 py-8 text-sm relative z-10">
        <p>¬© 2026 - Dr FENOHASINA Toto Jean Felicien</p>
    </footer>

    <script>
        const cheatsheetData = [
            {
                id: 'understand-syntax',
                title: 'üìù Comprendre la Syntaxe',
                icon: 'fa-code',
                color: 'border-l-4 border-amber-500',
                commands: [
                    {
                        cmd: 'Ma√Ætriser le format de base',
                        desc: '* * * * * commande (5 champs temporels)',
                        details: {
                            explanation: 'Une ligne crontab d√©finit quand et quelle commande ex√©cuter. Les 5 champs temporels suivis de la commande.',
                            syntax: 'minute heure jour_mois mois jour_semaine commande',
                            options: [
                                { flag: 'minute', desc: '0-59' },
                                { flag: 'heure', desc: '0-23' },
                                { flag: 'jour_mois', desc: '1-31' },
                                { flag: 'mois', desc: '1-12 ou jan-dec' },
                                { flag: 'jour_semaine', desc: '0-7 (0 et 7 = dimanche) ou sun-sat' }
                            ],
                            examples: [
                                { code: '30 8 * * * /home/user/script.sh', desc: 'Tous les jours √† 8h30' },
                                { code: '0 0 * * * /backup.sh', desc: 'Tous les jours √† minuit' },
                                { code: '0 9 * * 1 /weekly.sh', desc: 'Tous les lundis √† 9h' }
                            ],
                            tips: ['Utilisez crontab.guru pour v√©rifier vos expressions'],
                            warnings: ['Les chemins doivent √™tre absolus dans les crontabs']
                        }
                    },
                    {
                        cmd: 'Utiliser les caract√®res sp√©ciaux',
                        desc: '*, /, -, virgule pour plus de flexibilit√©',
                        details: {
                            explanation: 'Les caract√®res sp√©ciaux permettent des expressions plus flexibles.',
                            syntax: '* (tout) , (liste) - (plage) / (intervalle)',
                            options: [
                                { flag: '*', desc: 'Toute valeur possible' },
                                { flag: ',', desc: 'Liste de valeurs (1,3,5)' },
                                { flag: '-', desc: 'Plage de valeurs (1-5)' },
                                { flag: '/', desc: 'Intervalle (*/15 = tous les 15)' }
                            ],
                            examples: [
                                { code: '*/15 * * * * cmd', desc: 'Toutes les 15 minutes' },
                                { code: '0 9-17 * * * cmd', desc: 'Chaque heure de 9h √† 17h' },
                                { code: '0 0 1,15 * * cmd', desc: 'Le 1er et 15 de chaque mois' },
                                { code: '0 */2 * * * cmd', desc: 'Toutes les 2 heures' }
                            ],
                            tips: ['*/5 signifie "tous les 5" (minutes, heures, etc.)'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Utiliser les raccourcis temporels',
                        desc: '@hourly, @daily, @weekly, @reboot...',
                        details: {
                            explanation: 'Raccourcis pr√©d√©finis pour les planifications courantes.',
                            syntax: '@raccourci commande',
                            options: [
                                { flag: '@reboot', desc: 'Au d√©marrage du syst√®me' },
                                { flag: '@hourly', desc: 'Toutes les heures (0 * * * *)' },
                                { flag: '@daily', desc: 'Tous les jours √† minuit (0 0 * * *)' },
                                { flag: '@weekly', desc: 'Tous les dimanches (0 0 * * 0)' },
                                { flag: '@monthly', desc: 'Le 1er de chaque mois (0 0 1 * *)' },
                                { flag: '@yearly', desc: 'Le 1er janvier (0 0 1 1 *)' }
                            ],
                            examples: [
                                { code: '@reboot /home/user/startup.sh', desc: 'Script au d√©marrage' },
                                { code: '@daily /scripts/backup.sh', desc: 'Backup quotidien' },
                                { code: '@weekly /scripts/cleanup.sh', desc: 'Nettoyage hebdomadaire' }
                            ],
                            tips: ['@reboot est tr√®s utile pour d√©marrer des services personnalis√©s'],
                            warnings: ['Tous les syst√®mes ne supportent pas tous les raccourcis']
                        }
                    }
                ]
            },
            {
                id: 'manage-crontab',
                title: 'üñ•Ô∏è G√©rer la Crontab',
                icon: 'fa-terminal',
                color: 'border-l-4 border-blue-500',
                commands: [
                    {
                        cmd: '√âditer la crontab',
                        desc: 'crontab -e pour modifier les t√¢ches',
                        details: {
                            explanation: 'Ouvre l\'√©diteur pour modifier la crontab de l\'utilisateur courant.',
                            syntax: 'crontab -e',
                            options: [
                                { flag: '-e', desc: '√âditer la crontab' },
                                { flag: '-u user', desc: '√âditer la crontab d\'un autre utilisateur (root)' }
                            ],
                            examples: [
                                { code: 'crontab -e', desc: '√âditer sa propre crontab' },
                                { code: 'sudo crontab -e', desc: '√âditer la crontab de root' },
                                { code: 'sudo crontab -e -u www-data', desc: '√âditer celle de www-data' }
                            ],
                            tips: ['L\'√©diteur par d√©faut peut √™tre chang√© avec EDITOR=nano crontab -e'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Lister les t√¢ches cron',
                        desc: 'crontab -l pour voir les t√¢ches',
                        details: {
                            explanation: 'Affiche toutes les t√¢ches cron de l\'utilisateur.',
                            syntax: 'crontab -l [-u user]',
                            options: [
                                { flag: '-l', desc: 'Lister les t√¢ches' },
                                { flag: '-u user', desc: 'Lister pour un autre utilisateur' }
                            ],
                            examples: [
                                { code: 'crontab -l', desc: 'Voir ses t√¢ches' },
                                { code: 'sudo crontab -l -u root', desc: 'Voir les t√¢ches root' },
                                { code: 'crontab -l > backup_crontab.txt', desc: 'Sauvegarder sa crontab' }
                            ],
                            tips: ['Sauvegardez r√©guli√®rement votre crontab'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Supprimer la crontab',
                        desc: 'crontab -r (attention: pas de confirmation!)',
                        details: {
                            explanation: 'Supprime toute la crontab de l\'utilisateur. ATTENTION : pas de confirmation!',
                            syntax: 'crontab -r',
                            options: [
                                { flag: '-r', desc: 'Remove - supprime tout' },
                                { flag: '-i', desc: 'Interactive - demande confirmation' }
                            ],
                            examples: [
                                { code: 'crontab -r', desc: 'Supprime tout (DANGER!)' },
                                { code: 'crontab -ri', desc: 'Supprime avec confirmation' }
                            ],
                            tips: ['Utilisez toujours -ri pour avoir une confirmation'],
                            warnings: ['crontab -r supprime TOUT sans demander confirmation!']
                        }
                    }
                ]
            },
            {
                id: 'schedule-tasks',
                title: 'üìÖ Planifier des T√¢ches',
                icon: 'fa-calendar-check',
                color: 'border-l-4 border-green-500',
                commands: [
                    {
                        cmd: 'Planifier un backup quotidien',
                        desc: 'Sauvegarde automatique chaque nuit',
                        details: {
                            explanation: 'Script de backup ex√©cut√© automatiquement tous les jours.',
                            syntax: '0 2 * * * /path/to/backup.sh',
                            options: [],
                            examples: [
                                { code: '0 2 * * * tar -czf /backup/home_$(date +\\%Y\\%m\\%d).tar.gz /home/user', desc: 'Backup home √† 2h' },
                                { code: '0 3 * * * mysqldump -u root -p\'pass\' mydb > /backup/db_$(date +\\%Y\\%m\\%d).sql', desc: 'Backup MySQL √† 3h' },
                                { code: '0 4 * * 0 rsync -avz /data/ /backup/weekly/', desc: 'Rsync hebdomadaire (dimanche)' }
                            ],
                            tips: ['Utilisez date +\\%Y\\%m\\%d pour inclure la date (√©chapper le %)'],
                            warnings: ['Testez vos scripts manuellement avant de les planifier']
                        }
                    },
                    {
                        cmd: 'Planifier un nettoyage de logs',
                        desc: 'Rotation et suppression automatiques',
                        details: {
                            explanation: 'Supprime ou archive les vieux fichiers de logs automatiquement.',
                            syntax: '0 0 * * * find /var/log -name "*.log" -mtime +30 -delete',
                            options: [],
                            examples: [
                                { code: '0 0 * * * find /var/log -name "*.log" -mtime +30 -delete', desc: 'Supprimer logs > 30 jours' },
                                { code: '0 1 * * * find /tmp -type f -atime +7 -delete', desc: 'Nettoyer /tmp vieux de 7j' },
                                { code: '30 5 * * * logrotate /etc/logrotate.conf', desc: 'Rotation des logs √† 5h30' }
                            ],
                            tips: ['Utilisez -mtime pour la date de modification, -atime pour l\'acc√®s'],
                            warnings: ['Testez avec -print avant -delete pour voir ce qui sera supprim√©']
                        }
                    },
                    {
                        cmd: 'Planifier du monitoring',
                        desc: 'V√©rifications p√©riodiques avec alertes',
                        details: {
                            explanation: 'V√©rifications p√©riodiques avec notifications.',
                            syntax: '*/5 * * * * /check_script.sh',
                            options: [],
                            examples: [
                                { code: '*/5 * * * * /scripts/check_disk.sh | mail -s "Disk Alert" admin@example.com', desc: 'Check disque toutes les 5 min' },
                                { code: '0 * * * * curl -s https://mysite.com/health || echo "Site down" | mail -s "Alert" admin@ex.com', desc: 'Health check horaire' },
                                { code: '*/10 * * * * pgrep nginx || systemctl restart nginx', desc: 'Red√©marrer nginx si down' }
                            ],
                            tips: ['Utilisez || pour ex√©cuter une action si la commande √©choue'],
                            warnings: ['Attention au spam d\'emails si le check √©choue souvent']
                        }
                    }
                ]
            },
            {
                id: 'handle-output',
                title: 'üì§ G√©rer les Sorties',
                icon: 'fa-file-export',
                color: 'border-l-4 border-purple-500',
                commands: [
                    {
                        cmd: 'Rediriger les sorties vers des fichiers',
                        desc: '> pour stdout, 2>&1 pour stderr',
                        details: {
                            explanation: 'Par d√©faut, cron envoie la sortie par email. Redirigez vers des fichiers pour √©viter cela.',
                            syntax: 'commande > fichier 2>&1',
                            options: [
                                { flag: '> file', desc: 'Redirige stdout vers un fichier' },
                                { flag: '2>&1', desc: 'Redirige stderr vers stdout' },
                                { flag: '>> file', desc: 'Append au lieu d\'√©craser' },
                                { flag: '>/dev/null', desc: 'Supprime la sortie' }
                            ],
                            examples: [
                                { code: '0 * * * * /script.sh > /var/log/script.log 2>&1', desc: 'Log stdout et stderr' },
                                { code: '0 * * * * /script.sh >> /var/log/script.log 2>&1', desc: 'Append au log' },
                                { code: '0 * * * * /script.sh > /dev/null 2>&1', desc: 'Supprimer toute sortie' }
                            ],
                            tips: ['Toujours rediriger la sortie pour √©viter les emails intempestifs'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Configurer les notifications email',
                        desc: 'MAILTO pour d√©finir le destinataire',
                        details: {
                            explanation: 'Variable d\'environnement pour d√©finir le destinataire des sorties cron.',
                            syntax: 'MAILTO=email@example.com',
                            options: [
                                { flag: 'MAILTO=email', desc: 'Envoie les sorties √† cette adresse' },
                                { flag: 'MAILTO=""', desc: 'D√©sactive les emails' }
                            ],
                            examples: [
                                { code: 'MAILTO=admin@example.com\n0 * * * * /script.sh', desc: 'Envoyer les sorties par email' },
                                { code: 'MAILTO=""\n0 * * * * /script.sh', desc: 'D√©sactiver les emails' },
                                { code: 'MAILTO=admin@ex.com,backup@ex.com\n0 2 * * * /backup.sh', desc: 'Plusieurs destinataires' }
                            ],
                            tips: ['Mettez MAILTO en haut de votre crontab'],
                            warnings: ['N√©cessite un MTA configur√© (postfix, sendmail, etc.)']
                        }
                    }
                ]
            },
            {
                id: 'configure-env',
                title: '‚öôÔ∏è Configurer l\'Environnement',
                icon: 'fa-cog',
                color: 'border-l-4 border-red-500',
                commands: [
                    {
                        cmd: 'D√©finir les variables d\'environnement',
                        desc: 'PATH, SHELL, HOME en t√™te de crontab',
                        details: {
                            explanation: 'Les cron jobs s\'ex√©cutent avec un environnement minimal. D√©finissez les variables n√©cessaires.',
                            syntax: 'VARIABLE=valeur en haut de la crontab',
                            options: [
                                { flag: 'PATH', desc: 'Chemins de recherche des commandes' },
                                { flag: 'SHELL', desc: 'Shell utilis√© (d√©faut: /bin/sh)' },
                                { flag: 'HOME', desc: 'R√©pertoire home' }
                            ],
                            examples: [
                                { code: 'SHELL=/bin/bash\nPATH=/usr/local/bin:/usr/bin:/bin\nHOME=/home/user\n\n0 * * * * /script.sh', desc: 'Variables en t√™te de crontab' },
                                { code: '0 * * * * source ~/.bashrc && /script.sh', desc: 'Charger le profil bash' },
                                { code: '0 * * * * /usr/bin/env python3 /script.py', desc: 'Utiliser env pour Python' }
                            ],
                            tips: ['Le PATH par d√©faut de cron est tr√®s limit√©'],
                            warnings: ['Les variables de votre .bashrc ne sont PAS charg√©es automatiquement']
                        }
                    },
                    {
                        cmd: 'Utiliser les crontabs syst√®me',
                        desc: '/etc/cron.d/, /etc/cron.daily/, etc.',
                        details: {
                            explanation: 'R√©pertoire pour les crontabs syst√®me. Format l√©g√®rement diff√©rent (inclut l\'utilisateur).',
                            syntax: 'minute heure jour mois semaine USER commande',
                            options: [
                                { flag: '/etc/cron.d/', desc: 'Fichiers cron syst√®me' },
                                { flag: '/etc/cron.daily/', desc: 'Scripts ex√©cut√©s quotidiennement' },
                                { flag: '/etc/cron.hourly/', desc: 'Scripts ex√©cut√©s toutes les heures' },
                                { flag: '/etc/cron.weekly/', desc: 'Scripts ex√©cut√©s chaque semaine' },
                                { flag: '/etc/cron.monthly/', desc: 'Scripts ex√©cut√©s chaque mois' }
                            ],
                            examples: [
                                { code: '# /etc/cron.d/myapp\n*/5 * * * * www-data /var/www/app/cron.sh', desc: 'Fichier dans cron.d' },
                                { code: '# Placer un script dans /etc/cron.daily/\nchmod +x /etc/cron.daily/backup', desc: 'Script daily' }
                            ],
                            tips: ['Les scripts dans cron.daily/ ne doivent pas avoir d\'extension'],
                            warnings: ['Les fichiers dans cron.d doivent sp√©cifier l\'utilisateur']
                        }
                    }
                ]
            },
            {
                id: 'use-advanced-scheduling',
                title: 'üß© Utiliser les Planifications Avanc√©es',
                icon: 'fa-puzzle-piece',
                color: 'border-l-4 border-pink-500',
                commands: [
                    {
                        cmd: 'Cr√©er des expressions complexes',
                        desc: 'Combiner intervalles, plages et listes',
                        details: {
                            explanation: 'Combiner plusieurs champs pour des planifications pr√©cises et complexes.',
                            syntax: '*/15 9-17 * * 1-5 commande',
                            options: [
                                { flag: '*/N', desc: 'Tous les N intervalles' },
                                { flag: 'N-M', desc: 'De N √† M' },
                                { flag: 'N,M,O', desc: 'Liste de valeurs' },
                                { flag: 'N-M/S', desc: 'De N √† M par pas de S' }
                            ],
                            examples: [
                                { code: '*/15 9-17 * * 1-5 cmd', desc: 'Toutes les 15 min, 9h-17h, lun-ven' },
                                { code: '0 8-18/2 * * * cmd', desc: 'Heures paires de 8h √† 18h' },
                                { code: '0 0 1-7 * 0 cmd', desc: 'Premier dimanche du mois' },
                                { code: '30 4 1,15 * * cmd', desc: '1er et 15 √† 4h30' }
                            ],
                            tips: ['Utilisez crontab.guru pour valider les expressions complexes'],
                            warnings: ['Certains caract√®res comme L ne sont pas support√©s partout']
                        }
                    },
                    {
                        cmd: 'Ex√©cuter conditionnellement',
                        desc: 'Ajouter des conditions avant ex√©cution',
                        details: {
                            explanation: 'Ex√©cuter des t√¢ches seulement si certaines conditions sont remplies.',
                            syntax: '* * * * * [ condition ] && commande',
                            options: [
                                { flag: '[ -f file ]', desc: 'Si le fichier existe' },
                                { flag: '$(date +%d)', desc: 'Jour du mois' },
                                { flag: 'pgrep process', desc: 'Si processus existe' },
                                { flag: 'flock', desc: 'Verrou pour √©viter ex√©cutions parall√®les' }
                            ],
                            examples: [
                                { code: '0 0 * * * [ $(date +\\%d) -le 7 ] && [ $(date +\\%u) -eq 1 ] && /scripts/monthly.sh', desc: 'Premier lundi du mois' },
                                { code: '*/5 * * * * [ -f /var/run/myapp.pid ] || /scripts/start_myapp.sh', desc: 'D√©marrer si absent' },
                                { code: '0 * * * * pgrep -x nginx >/dev/null || systemctl restart nginx', desc: 'Watchdog nginx' }
                            ],
                            tips: ['Combinez avec && et || pour cr√©er des conditions complexes'],
                            warnings: ['Attention √† l\'√©chappement du % dans crontab']
                        }
                    },
                    {
                        cmd: '√âviter les ex√©cutions parall√®les (flock)',
                        desc: 'Utiliser un verrou pour emp√™cher les doublons',
                        details: {
                            explanation: 'Utilise un verrou pour emp√™cher les ex√©cutions simultan√©es du m√™me script.',
                            syntax: 'flock [-n|-w timeout] lockfile command',
                            options: [
                                { flag: '-n', desc: 'Non-bloquant (√©choue si verrou pris)' },
                                { flag: '-w N', desc: 'Attendre N secondes max' },
                                { flag: '-x', desc: 'Verrou exclusif (d√©faut)' },
                                { flag: '-s', desc: 'Verrou partag√© (lecture)' }
                            ],
                            examples: [
                                { code: '*/5 * * * * flock -n /tmp/backup.lock /scripts/backup.sh', desc: 'Skip si d√©j√† en cours' },
                                { code: '*/10 * * * * flock -w 60 /tmp/sync.lock /scripts/sync.sh', desc: 'Attendre 60s max' },
                                { code: '#!/bin/bash\nexec 200>/tmp/myscript.lock\nflock -n 200 || { echo "D√©j√† en cours"; exit 1; }\n# ... reste du script', desc: 'Verrou dans le script' }
                            ],
                            tips: ['flock est la m√©thode standard pour √©viter les courses'],
                            warnings: ['Le fichier de verrou doit √™tre sur un syst√®me de fichiers local']
                        }
                    }
                ]
            },
            {
                id: 'debug-cron',
                title: 'üêõ D√©boguer les Jobs Cron',
                icon: 'fa-bug',
                color: 'border-l-4 border-orange-500',
                commands: [
                    {
                        cmd: 'Consulter les logs cron',
                        desc: 'journalctl et /var/log/syslog',
                        details: {
                            explanation: 'M√©thodes pour diagnostiquer les probl√®mes avec les t√¢ches cron.',
                            syntax: 'journalctl / /var/log/syslog',
                            options: [
                                { flag: 'journalctl -u cron', desc: 'Logs du service cron' },
                                { flag: '/var/log/syslog', desc: 'Logs syst√®me (Debian/Ubuntu)' },
                                { flag: '/var/log/cron', desc: 'Logs cron (RHEL/CentOS)' }
                            ],
                            examples: [
                                { code: 'journalctl -u cron --since "1 hour ago"\ngrep CRON /var/log/syslog | tail -50', desc: 'Logs cron r√©cents' },
                                { code: '* * * * * /scripts/task.sh >> /var/log/task.log 2>&1', desc: 'Logger la sortie' },
                                { code: '* * * * * bash -x /scripts/task.sh >> /var/log/task_debug.log 2>&1', desc: 'Trace compl√®te avec bash -x' }
                            ],
                            tips: ['bash -x affiche chaque commande avant ex√©cution'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Simuler l\'environnement cron',
                        desc: 'Tester avec un environnement minimal',
                        details: {
                            explanation: 'Tester un script dans les m√™mes conditions que cron (environnement minimal).',
                            syntax: 'env -i /bin/sh -c "script"',
                            options: [
                                { flag: 'env -i', desc: 'Vider l\'environnement' },
                                { flag: 'PATH=/usr/bin:/bin', desc: 'PATH minimal de cron' }
                            ],
                            examples: [
                                { code: 'env -i HOME=$HOME PATH=/usr/bin:/bin SHELL=/bin/sh /scripts/task.sh', desc: 'Test avec env minimal' },
                                { code: '# Dans cron: * * * * * env > /tmp/cron_env.txt\n# En terminal: env > /tmp/shell_env.txt\ndiff /tmp/shell_env.txt /tmp/cron_env.txt', desc: 'Comparer les environnements' }
                            ],
                            tips: ['Les scripts doivent fonctionner avec un PATH minimal'],
                            warnings: ['Cron n\'a pas acc√®s √† votre .bashrc ni vos variables d\'env']
                        }
                    },
                    {
                        cmd: 'R√©soudre les probl√®mes courants',
                        desc: 'Chemins, permissions, PATH...',
                        details: {
                            explanation: 'Les erreurs les plus fr√©quentes avec cron et leurs solutions.',
                            syntax: 'Diagnostic ‚Üí Solution',
                            options: [
                                { flag: 'Script non trouv√©', desc: 'Utiliser des chemins absolus' },
                                { flag: 'Permission denied', desc: 'V√©rifier chmod +x et propri√©taire' },
                                { flag: 'Command not found', desc: 'PATH non d√©fini dans cron' },
                                { flag: 'Pas de sortie', desc: 'Rediriger stdout et stderr' }
                            ],
                            examples: [
                                { code: '# ‚ùå Chemin relatif\n0 * * * * ./script.sh\n# ‚úÖ Chemin absolu\n0 * * * * /home/user/scripts/script.sh', desc: 'Chemins absolus' },
                                { code: '# ‚ùå Commande sans PATH\n0 * * * * python3 script.py\n# ‚úÖ Chemin complet\n0 * * * * /usr/bin/python3 /home/user/script.py', desc: 'Chemin complet des binaires' },
                                { code: '# ‚ùå % non √©chapp√©\n0 * * * * echo $(date +%Y-%m-%d)\n# ‚úÖ % √©chapp√©\n0 * * * * echo $(date +\\%Y-\\%m-\\%d)', desc: '√âchapper le %' }
                            ],
                            tips: ['which commande pour trouver le chemin complet d\'un binaire'],
                            warnings: []
                        }
                    }
                ]
            },
            {
                id: 'apply-best-practices',
                title: '‚úîÔ∏è Appliquer les Bonnes Pratiques',
                icon: 'fa-check-double',
                color: 'border-l-4 border-indigo-500',
                commands: [
                    {
                        cmd: 'Cr√©er un template de script robuste',
                        desc: 'Structure recommand√©e pour scripts cron',
                        details: {
                            explanation: 'Structure recommand√©e pour un script destin√© √† cron.',
                            syntax: '#!/bin/bash\nset -euo pipefail',
                            options: [],
                            examples: [
                                { code: '#!/bin/bash\n#\n# Script: backup-daily.sh\n# Cron: 0 2 * * * /scripts/backup-daily.sh\n#\nset -euo pipefail\n\n# Configuration\nSCRIPT_NAME="backup-daily"\nLOG_FILE="/var/log/${SCRIPT_NAME}.log"\nLOCK_FILE="/tmp/${SCRIPT_NAME}.lock"\n\n# Logging\nlog() { echo "[$(date \'+%Y-%m-%d %H:%M:%S\')] $*" >> "$LOG_FILE"; }\ndie() { log "ERREUR: $*"; exit 1; }\n\n# Verrou\nexec 200>"$LOCK_FILE"\nflock -n 200 || die "D√©j√† en cours d\'ex√©cution"\n\n# Cleanup √† la fin\ntrap \'log "=== Fin $SCRIPT_NAME (code: $?) ==="\' EXIT\n\nlog "=== D√©marrage $SCRIPT_NAME ==="\n# Votre code ici...\nlog "T√¢che termin√©e avec succ√®s"', desc: 'Template complet' }
                            ],
                            tips: ['Ce template g√®re logging, verrou, rotation et cleanup'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Configurer les notifications d\'erreur',
                        desc: 'Email, webhook, healthcheck.io',
                        details: {
                            explanation: 'Configurer des notifications pour √™tre alert√© des √©checs.',
                            syntax: 'MAILTO / webhook / healthcheck',
                            options: [],
                            examples: [
                                { code: '# Notification sur erreur seulement\n0 * * * * /script.sh 2>&1 | ifne mail -s "Cron Error" admin@example.com', desc: 'Email sur erreur' },
                                { code: '# Webhook Slack/Discord\nnotify_error() {\n  curl -s -X POST -H "Content-type: application/json" \\\n    -d "{\\\"text\\\": \\\"‚ùå Cron failed: $1\\\"}" \\\n    "$SLACK_WEBHOOK_URL"\n}\n\n/script.sh || notify_error "backup-daily"', desc: 'Webhook notification' },
                                { code: '# Healthcheck.io (ping de vie)\n0 * * * * curl -fsS https://hc-ping.com/UUID/start && /script.sh && curl -fsS https://hc-ping.com/UUID || curl -fsS https://hc-ping.com/UUID/fail', desc: 'Healthcheck.io' }
                            ],
                            tips: ['Healthcheck.io alerte aussi si le job ne s\'ex√©cute pas'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Organiser la crontab',
                        desc: 'Documenter et grouper les t√¢ches',
                        details: {
                            explanation: 'Bonnes pratiques pour organiser et documenter la crontab.',
                            syntax: '# Commentaires explicatifs',
                            options: [],
                            examples: [
                                { code: '# ========================================\n# Crontab de production - myapp\n# Derni√®re mise √† jour: 2024-01-15\n# ========================================\n\n# --- Variables ---\nSHELL=/bin/bash\nPATH=/usr/local/bin:/usr/bin:/bin\nMAILTO=admin@example.com\n\n# --- Backups (fen√™tre: 2h-4h) ---\n0 2 * * * /scripts/backup-db.sh\n30 2 * * * /scripts/backup-files.sh\n\n# --- Maintenance (fen√™tre: 4h-6h) ---\n0 4 * * 0 /scripts/cleanup-logs.sh\n\n# --- Monitoring (permanent) ---\n*/5 * * * * /scripts/healthcheck.sh', desc: 'Crontab organis√©e' }
                            ],
                            tips: ['Groupez les t√¢ches par fonction et documentez les fen√™tres'],
                            warnings: []
                        }
                    }
                ]
            },
            {
                id: 'explore-alternatives',
                title: 'üîÄ Explorer les Alternatives',
                icon: 'fa-exchange-alt',
                color: 'border-l-4 border-cyan-500',
                commands: [
                    {
                        cmd: 'Utiliser les timers systemd',
                        desc: 'Alternative moderne avec plus de contr√¥le',
                        details: {
                            explanation: 'Les timers systemd offrent plus de flexibilit√© que cron (logs, d√©pendances, etc.).',
                            syntax: 'systemctl enable/start mon-timer.timer',
                            options: [
                                { flag: 'OnCalendar', desc: 'Planification style calendrier' },
                                { flag: 'OnBootSec', desc: 'D√©lai apr√®s le boot' },
                                { flag: 'Persistent', desc: 'Rattrape les ex√©cutions manqu√©es' }
                            ],
                            examples: [
                                { code: '# /etc/systemd/system/backup.timer\n[Unit]\nDescription=Daily backup\n\n[Timer]\nOnCalendar=*-*-* 02:00:00\nPersistent=true\n\n[Install]\nWantedBy=timers.target', desc: 'Timer quotidien √† 2h' },
                                { code: 'systemctl list-timers --all', desc: 'Lister tous les timers' },
                                { code: 'systemctl enable --now backup.timer', desc: 'Activer un timer' }
                            ],
                            tips: ['Les timers systemd permettent de voir facilement les logs avec journalctl'],
                            warnings: ['N√©cessite un fichier .service associ√©']
                        }
                    },
                    {
                        cmd: 'Utiliser la commande at',
                        desc: 'Ex√©cution unique √† un moment pr√©cis',
                        details: {
                            explanation: 'Planifie une commande pour une ex√©cution unique √† un moment pr√©cis.',
                            syntax: 'at TIME < script.sh\necho "cmd" | at TIME',
                            options: [
                                { flag: 'at now + 1 hour', desc: 'Dans une heure' },
                                { flag: 'at 15:00', desc: '√Ä 15h aujourd\'hui' },
                                { flag: 'at noon tomorrow', desc: 'Demain √† midi' },
                                { flag: 'atq', desc: 'Lister les jobs at' },
                                { flag: 'atrm N', desc: 'Supprimer le job N' }
                            ],
                            examples: [
                                { code: 'echo "/scripts/deploy.sh" | at 02:00', desc: 'D√©ployer √† 2h' },
                                { code: 'at now + 30 minutes <<< "systemctl restart nginx"', desc: 'Restart dans 30 min' },
                                { code: 'atq\natrm 5', desc: 'Lister et supprimer un job' }
                            ],
                            tips: ['Utilisez at pour des t√¢ches ponctuelles, cron pour les r√©currentes'],
                            warnings: []
                        }
                    }
                ]
            },
            {
                id: 'project-automation',
                title: 'üéØ Projet: Pipeline d\'Automatisation',
                icon: 'fa-cogs',
                color: 'border-l-4 border-emerald-500',
                commands: [
                    {
                        cmd: '√âtape 1: Analyser les besoins',
                        desc: 'Inventaire des t√¢ches √† automatiser',
                        details: {
                            explanation: 'Identifier et cat√©goriser toutes les t√¢ches √† automatiser.',
                            syntax: 'Inventaire ‚Üí Priorisation ‚Üí Planification',
                            options: [],
                            examples: [
                                { code: '# Inventaire des t√¢ches\n\n## BACKUPS (Critique - Quotidien)\n- [ ] Backup base de donn√©es\n- [ ] Backup fichiers uploads\n- [ ] Sync vers stockage distant\n\n## MAINTENANCE (Important - Hebdomadaire)\n- [ ] Rotation des logs\n- [ ] Nettoyage fichiers temporaires\n- [ ] Optimisation DB\n\n## MONITORING (Critique - Continu)\n- [ ] Health check application\n- [ ] V√©rification espace disque\n- [ ] Alertes en cas de probl√®me', desc: 'Inventaire type' }
                            ],
                            tips: ['Classez par criticit√©: Critique > Important > Utile'],
                            warnings: []
                        }
                    },
                    {
                        cmd: '√âtape 2: Structurer les scripts',
                        desc: 'Organisation des fichiers',
                        details: {
                            explanation: 'Cr√©er une structure de r√©pertoires organis√©e pour les scripts.',
                            syntax: '/opt/scripts/{backup,maintenance,monitoring}',
                            options: [],
                            examples: [
                                { code: 'sudo mkdir -p /opt/scripts/{backup,maintenance,monitoring,lib,config}\nsudo mkdir -p /var/log/scripts\n\n# Structure finale\n/opt/scripts/\n‚îú‚îÄ‚îÄ backup/\n‚îÇ   ‚îú‚îÄ‚îÄ backup-database.sh\n‚îÇ   ‚îî‚îÄ‚îÄ backup-files.sh\n‚îú‚îÄ‚îÄ maintenance/\n‚îÇ   ‚îú‚îÄ‚îÄ cleanup-logs.sh\n‚îÇ   ‚îî‚îÄ‚îÄ optimize-db.sh\n‚îú‚îÄ‚îÄ monitoring/\n‚îÇ   ‚îî‚îÄ‚îÄ healthcheck.sh\n‚îú‚îÄ‚îÄ lib/\n‚îÇ   ‚îî‚îÄ‚îÄ common.sh\n‚îî‚îÄ‚îÄ config/\n    ‚îî‚îÄ‚îÄ backup.conf', desc: 'Structure recommand√©e' }
                            ],
                            tips: ['S√©parez la config des scripts pour faciliter les mises √† jour'],
                            warnings: []
                        }
                    },
                    {
                        cmd: '√âtape 3: Cr√©er la biblioth√®que commune',
                        desc: 'Fonctions r√©utilisables',
                        details: {
                            explanation: 'Cr√©er une biblioth√®que de fonctions communes √† tous les scripts.',
                            syntax: '/opt/scripts/lib/common.sh',
                            options: [],
                            examples: [
                                { code: '#!/bin/bash\n# /opt/scripts/lib/common.sh\nset -euo pipefail\n\n# Logging\nSCRIPT_NAME="${SCRIPT_NAME:-$(basename "$0" .sh)}"\nLOG_FILE="/var/log/scripts/${SCRIPT_NAME}.log"\n\nlog() { echo "[$(date \'+%Y-%m-%d %H:%M:%S\')] $*" | tee -a "$LOG_FILE"; }\ninfo()  { log "INFO: $@"; }\nerror() { log "ERROR: $@" >&2; }\ndie()   { error "$@"; exit 1; }\n\n# Verrou\nLOCK_FILE="/tmp/${SCRIPT_NAME}.lock"\nacquire_lock() {\n  exec 200>"$LOCK_FILE"\n  flock -n 200 || die "Script d√©j√† en cours"\n}\n\n# Cleanup\ntrap \'[ $? -eq 0 ] && info "Termin√©" || error "√âchec (code: $?)"\' EXIT', desc: 'Biblioth√®que commune' }
                            ],
                            tips: ['Source cette biblioth√®que dans tous vos scripts'],
                            warnings: []
                        }
                    },
                    {
                        cmd: '√âtape 4: Impl√©menter le backup',
                        desc: 'Script de sauvegarde complet',
                        details: {
                            explanation: 'Script de backup professionnel avec rotation et sync distant.',
                            syntax: '/opt/scripts/backup/backup-all.sh',
                            options: [],
                            examples: [
                                { code: '#!/bin/bash\nSCRIPT_NAME="backup-all"\nsource /opt/scripts/lib/common.sh\nsource /opt/scripts/config/backup.conf\n\nacquire_lock\ninfo "=== D√©marrage backup =="\n\nDATE=$(date +%Y%m%d_%H%M%S)\nBACKUP_DIR="${BACKUP_BASE}/${DATE}"\nmkdir -p "$BACKUP_DIR"\n\n# 1. Backup DB\ninfo "Backup PostgreSQL..."\nsudo -u postgres pg_dump -Fc "$DB_NAME" | gzip > "$BACKUP_DIR/database.sql.gz"\n\n# 2. Backup fichiers\ninfo "Backup fichiers..."\ntar -czf "$BACKUP_DIR/files.tar.gz" -C "$APP_DIR" uploads config\n\n# 3. Rotation\ninfo "Rotation..."\nfind "$BACKUP_BASE" -maxdepth 1 -type d -mtime +${RETENTION_DAYS} -exec rm -rf {} \\;\n\ninfo "=== Backup termin√© ==="', desc: 'Script backup' }
                            ],
                            tips: ['Testez la restauration r√©guli√®rement !'],
                            warnings: []
                        }
                    },
                    {
                        cmd: '√âtape 5: Ajouter le monitoring',
                        desc: 'Surveillance avec alertes',
                        details: {
                            explanation: 'Scripts de monitoring avec alertes automatiques.',
                            syntax: '/opt/scripts/monitoring/healthcheck.sh',
                            options: [],
                            examples: [
                                { code: '#!/bin/bash\nSCRIPT_NAME="healthcheck"\nsource /opt/scripts/lib/common.sh\n\nALERTS=()\n\n# Check disk (> 80%)\nDISK=$(df / | awk \'NR==2 {print $5}\' | tr -d \'%\')\n[ "$DISK" -gt 80 ] && ALERTS+=("Disque: ${DISK}%")\n\n# Check services\nfor svc in nginx postgresql; do\n  systemctl is-active --quiet "$svc" || ALERTS+=("Service down: $svc")\ndone\n\n# Check URL\nHTTP=$(curl -s -o /dev/null -w "%{http_code}" "${APP_URL}/health" || echo "000")\n[ "$HTTP" != "200" ] && ALERTS+=("HTTP: code $HTTP")\n\n# Envoyer alertes\nif [ ${#ALERTS[@]} -gt 0 ]; then\n  echo "‚ö†Ô∏è ALERTES: ${ALERTS[*]}" | mail -s "Alert $(hostname)" admin@example.com\nfi', desc: 'Health check' }
                            ],
                            tips: ['Ajustez les seuils selon votre environnement'],
                            warnings: []
                        }
                    },
                    {
                        cmd: '√âtape 6: Assembler la crontab',
                        desc: 'Orchestration compl√®te',
                        details: {
                            explanation: 'Assembler toutes les t√¢ches dans une crontab organis√©e.',
                            syntax: 'crontab -e',
                            options: [],
                            examples: [
                                { code: '# ============================================\n# CRONTAB PRODUCTION - myapp\n# ============================================\n\nSHELL=/bin/bash\nPATH=/usr/local/bin:/usr/bin:/bin\nMAILTO=""\n\n# --- MONITORING (Permanent) ---\n*/5 * * * * /opt/scripts/monitoring/healthcheck.sh\n\n# --- BACKUPS (02:00-04:00) ---\n0 2 * * * /opt/scripts/backup/backup-all.sh\n\n# --- MAINTENANCE (04:00-06:00) ---\n0 4 * * * /opt/scripts/maintenance/rotate-logs.sh\n30 4 * * 0 /opt/scripts/maintenance/optimize-db.sh\n\n# --- RAPPORTS (Heures ouvr√©es) ---\n0 8 * * 1-5 /opt/scripts/reports/daily-report.sh', desc: 'Crontab compl√®te' }
                            ],
                            tips: ['Documentez et versionnez votre crontab avec Git'],
                            warnings: []
                        }
                    },
                    {
                        cmd: '√âtape 7: Cr√©er le tableau de bord',
                        desc: 'Suivi des ex√©cutions',
                        details: {
                            explanation: 'Script pour g√©n√©rer un rapport d\'√©tat des t√¢ches cron.',
                            syntax: '/opt/scripts/cron-status.sh',
                            options: [],
                            examples: [
                                { code: '#!/bin/bash\necho "=== √âTAT DES T√ÇCHES =="\necho "$(date)"\necho\n\necho "--- Derni√®res ex√©cutions ---"\nfor log in /var/log/scripts/*.log; do\n  name=$(basename "$log" .log)\n  last=$(tail -1 "$log" 2>/dev/null | cut -d\']\' -f1 | tr -d \'[\')\n  errors=$(grep -c "ERROR" "$log" 2>/dev/null || echo "0")\n  if [ "$errors" -gt 0 ]; then\n    echo "$name: $last ‚ö†Ô∏è ($errors erreurs)"\n  else\n    echo "$name: $last ‚úì"\n  fi\ndone\n\necho\necho "--- Espace backups ---"\ndu -sh /backup/* 2>/dev/null | tail -5', desc: 'Script de status' },
                                { code: '# Rapport quotidien par email\n0 7 * * * /opt/scripts/cron-status.sh | mail -s "Cron Status" admin@example.com', desc: 'Rapport email' }
                            ],
                            tips: ['Automatisez ce rapport pour une vue quotidienne'],
                            warnings: []
                        }
                    }
                ]
            }
        ];
    </script>
    <script src="../js/cheatsheet.js"></script>
</body>
</html>
