<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Aide-m√©moire DevSecOps : SAST, SCA, secrets, conteneurs, DAST, IaC, Kubernetes, CI/CD s√©curis√© et monitoring.">
    <title>DevSecOps - IT Cheatsheets</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body class="dark-theme text-slate-200">

    <header class="bg-slate-900/50 border-b border-white/5 py-8 px-4 relative overflow-hidden header-glow">
        <div class="max-w-4xl mx-auto relative z-10">
            <div class="flex items-center justify-between mb-4">
                <a href="../index.html" class="nav-back inline-flex items-center text-slate-400 hover:text-sky-400 transition">
                    <i class="fas fa-arrow-left mr-2"></i>Retour
                </a>
                <a href="../index.html" class="inline-flex items-center text-slate-400 hover:text-sky-400 transition">
                    <i class="fas fa-home mr-2"></i>Accueil
                </a>
            </div>
            <div class="text-center">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-xl bg-emerald-500/20 mb-4 icon-glow">
                    <i class="fas fa-shield-alt text-3xl text-emerald-400"></i>
                </div>
                <h1 class="text-3xl font-bold mb-2 gradient-text">DevSecOps</h1>
                <p class="text-slate-400">SAST, SCA, secrets, conteneurs, DAST, IaC et securite Kubernetes</p>
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-4 relative z-10">
        <div class="mb-8 relative">
            <input type="text" id="searchInput" placeholder="Rechercher une commande..."
                   class="search-dark w-full p-4 pl-12 rounded-lg outline-none transition">
            <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-500"></i>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="categoriesGrid"></div>
    </main>

    <div id="detailModal" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50 p-4 modal-overlay" onclick="closeModal(event)">
        <div class="modal-content-dark rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl modal-content" onclick="event.stopPropagation()">
            <div id="modalContent"></div>
        </div>
    </div>

    <footer class="border-t border-white/5 text-center text-slate-500 py-8 text-sm relative z-10">
        <p>¬© 2026 - Dr FENOHASINA Toto Jean Felicien</p>
    </footer>

    <script>
        const cheatsheetData = [
            {
                id: 'sast-code',
                title: 'üîç Analyser mon Code (SAST)',
                icon: 'fa-code',
                color: 'border-l-4 border-blue-500',
                commands: [
                    {
                        cmd: 'Scanner avec Semgrep',
                        desc: 'semgrep scan, regles, SARIF',
                        details: {
                            explanation: 'Semgrep est un outil SAST open-source rapide et configurable pour detecter les vulnerabilites dans le code source.',
                            syntax: 'semgrep scan --config=auto .\nsemgrep scan --config=p/owasp-top-ten .',
                            options: [
                                { flag: '--config=auto', desc: 'Detection automatique du langage' },
                                { flag: '--config=p/NAME', desc: 'Ruleset predefinies (owasp, security-audit)' },
                                { flag: '--sarif', desc: 'Output format SARIF' },
                                { flag: '--json', desc: 'Output JSON' },
                                { flag: '--severity=ERROR', desc: 'Filtrer par severite' }
                            ],
                            examples: [
                                { code: '# Scan avec regles auto\nsemgrep scan --config=auto .\n\n# Scan OWASP Top 10\nsemgrep scan --config=p/owasp-top-ten --sarif -o results.sarif .', desc: 'Scan basique' },
                                { code: '# Regles personnalisees\nrules:\n  - id: hardcoded-secret\n    pattern: password = "$PASSWORD"\n    message: "Secret hardcode detecte"\n    severity: ERROR\n    languages: [python]', desc: 'Regle custom YAML' },
                                { code: '# GitHub Actions\n- uses: returntocorp/semgrep-action@v1\n  with:\n    config: p/security-audit', desc: 'CI Integration' }
                            ],
                            tips: ['Utilisez --config=auto pour commencer', 'Creez des regles custom pour votre codebase'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Analyser avec SonarQube',
                        desc: 'sonar-scanner, quality gates',
                        details: {
                            explanation: 'SonarQube analyse la qualite du code et detecte les bugs, vulnerabilites et code smells.',
                            syntax: 'sonar-scanner -Dsonar.projectKey=myproject',
                            options: [
                                { flag: 'sonar.projectKey', desc: 'Identifiant du projet' },
                                { flag: 'sonar.sources', desc: 'Repertoires sources' },
                                { flag: 'sonar.host.url', desc: 'URL du serveur SonarQube' },
                                { flag: 'sonar.token', desc: 'Token d\'authentification' }
                            ],
                            examples: [
                                { code: '# sonar-project.properties\nsonar.projectKey=myapp\nsonar.sources=src\nsonar.host.url=https://sonarqube.example.com\nsonar.token=${SONAR_TOKEN}', desc: 'Configuration' },
                                { code: '# Scan\nsonar-scanner\n\n# Avec Docker\ndocker run --rm -v $(pwd):/usr/src sonarsource/sonar-scanner-cli', desc: 'Execution' },
                                { code: '# Quality Gate check\ncurl -s -u ${SONAR_TOKEN}: \\\n  "${SONAR_URL}/api/qualitygates/project_status?projectKey=${PROJECT}" | \\\n  jq -e ".projectStatus.status == \\"OK\\""', desc: 'Verifier Quality Gate' }
                            ],
                            tips: ['Configurez des Quality Gates strictes', 'Integrez dans les PR pour bloquer les merges'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Linter securite Python',
                        desc: 'bandit, safety',
                        details: {
                            explanation: 'Bandit analyse le code Python pour detecter les problemes de securite courants.',
                            syntax: 'bandit -r src/\nsafety check',
                            options: [
                                { flag: '-r, --recursive', desc: 'Scan recursif' },
                                { flag: '-f json', desc: 'Output JSON' },
                                { flag: '-ll', desc: 'Niveau de confiance minimum' },
                                { flag: '-s B101', desc: 'Skip certains tests' }
                            ],
                            examples: [
                                { code: '# Bandit scan\nbandit -r src/ -f json -o bandit-report.json\n\n# Exclure tests\nbandit -r src/ -x tests/', desc: 'Bandit' },
                                { code: '# Safety (dependances)\npip install safety\nsafety check --full-report\nsafety check -r requirements.txt', desc: 'Safety' },
                                { code: '# Pre-commit hook\nrepos:\n  - repo: https://github.com/PyCQA/bandit\n    rev: 1.7.5\n    hooks:\n      - id: bandit\n        args: ["-ll"]', desc: 'Pre-commit' }
                            ],
                            tips: ['Combinez bandit (code) et safety (deps)'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Linter securite JavaScript',
                        desc: 'eslint-plugin-security, njsscan',
                        details: {
                            explanation: 'Detecte les vulnerabilites dans le code JavaScript/Node.js.',
                            syntax: 'eslint --ext .js,.ts src/\nnjsscan --sarif -o report.sarif .',
                            options: [
                                { flag: 'eslint-plugin-security', desc: 'Plugin ESLint securite' },
                                { flag: 'njsscan', desc: 'Scanner SAST Node.js' }
                            ],
                            examples: [
                                { code: '# .eslintrc.js\nmodule.exports = {\n  plugins: ["security"],\n  extends: ["plugin:security/recommended"],\n  rules: {\n    "security/detect-object-injection": "error",\n    "security/detect-non-literal-regexp": "warn"\n  }\n};', desc: 'ESLint config' },
                                { code: '# njsscan\npip install njsscan\nnjsscan --sarif -o results.sarif ./src', desc: 'njsscan' },
                                { code: '# npm audit\nnpm audit\nnpm audit --json > audit.json\nnpm audit fix', desc: 'npm audit' }
                            ],
                            tips: ['Ajoutez eslint-plugin-security a votre config ESLint existante'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Integrer dans CI/CD',
                        desc: 'GitHub Actions, GitLab CI',
                        details: {
                            explanation: 'Automatise les scans SAST dans votre pipeline CI/CD.',
                            syntax: 'jobs:\n  sast:\n    runs-on: ubuntu-latest',
                            options: [
                                { flag: 'continue-on-error', desc: 'Ne pas bloquer le pipeline' },
                                { flag: 'upload-sarif', desc: 'Upload vers Security tab' }
                            ],
                            examples: [
                                { code: '# .github/workflows/sast.yml\nname: SAST\non: [push, pull_request]\njobs:\n  semgrep:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - uses: returntocorp/semgrep-action@v1\n        with:\n          config: >-\n            p/security-audit\n            p/secrets\n      - uses: github/codeql-action/upload-sarif@v2\n        with:\n          sarif_file: semgrep.sarif', desc: 'GitHub Actions' },
                                { code: '# .gitlab-ci.yml\nsast:\n  stage: test\n  image: returntocorp/semgrep\n  script:\n    - semgrep scan --config=auto --sarif -o gl-sast-report.sarif .\n  artifacts:\n    reports:\n      sast: gl-sast-report.sarif', desc: 'GitLab CI' }
                            ],
                            tips: ['Uploadez les SARIF pour visualiser dans GitHub Security'],
                            warnings: []
                        }
                    }
                ]
            },
            {
                id: 'sca-deps',
                title: 'üì¶ Scanner mes Dependances (SCA)',
                icon: 'fa-boxes',
                color: 'border-l-4 border-green-500',
                commands: [
                    {
                        cmd: 'Analyser avec Snyk',
                        desc: 'snyk test, snyk monitor',
                        details: {
                            explanation: 'Snyk detecte les vulnerabilites dans vos dependances et conteneurs.',
                            syntax: 'snyk test\nsnyk monitor',
                            options: [
                                { flag: 'test', desc: 'Scan local (CI)' },
                                { flag: 'monitor', desc: 'Envoie vers dashboard' },
                                { flag: '--severity-threshold', desc: 'Seuil minimum' },
                                { flag: '--sarif-file-output', desc: 'Output SARIF' }
                            ],
                            examples: [
                                { code: '# Installation\nnpm install -g snyk\nsnyk auth\n\n# Scan\nsnyk test\nsnyk test --severity-threshold=high', desc: 'CLI basique' },
                                { code: '# Container scan\nsnyk container test myimage:latest\nsnyk container monitor myimage:latest', desc: 'Container' },
                                { code: '# CI/CD\n- name: Snyk\n  uses: snyk/actions/node@master\n  env:\n    SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}\n  with:\n    args: --severity-threshold=high', desc: 'GitHub Actions' }
                            ],
                            tips: ['snyk monitor envoie les resultats au dashboard pour suivi continu'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Scanner avec Trivy',
                        desc: 'trivy fs, SBOM',
                        details: {
                            explanation: 'Trivy est un scanner open-source polyvalent pour vulnerabilites et misconfigurations.',
                            syntax: 'trivy fs .\ntrivy image myimage:latest',
                            options: [
                                { flag: 'fs', desc: 'Scan filesystem (deps)' },
                                { flag: 'image', desc: 'Scan image Docker' },
                                { flag: 'config', desc: 'Scan IaC configs' },
                                { flag: '--severity', desc: 'Filtrer par severite' },
                                { flag: '--format sarif', desc: 'Output SARIF' }
                            ],
                            examples: [
                                { code: '# Scan dependances\ntrivy fs --severity HIGH,CRITICAL .\n\n# Scan avec SBOM\ntrivy fs --format cyclonedx -o sbom.json .', desc: 'Filesystem' },
                                { code: '# Image scan\ntrivy image --severity HIGH,CRITICAL myapp:latest\n\n# Ignorer unfixed\ntrivy image --ignore-unfixed myapp:latest', desc: 'Container' },
                                { code: '# CI avec exit code\ntrivy fs --exit-code 1 --severity CRITICAL .', desc: 'CI blocking' }
                            ],
                            tips: ['Trivy peut scanner deps, images, IaC et Kubernetes'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Utiliser Dependabot',
                        desc: 'configuration, alertes',
                        details: {
                            explanation: 'Dependabot cree automatiquement des PR pour mettre a jour les dependances vulnerables.',
                            syntax: '.github/dependabot.yml',
                            options: [
                                { flag: 'package-ecosystem', desc: 'Type de deps (npm, pip, docker)' },
                                { flag: 'schedule.interval', desc: 'Frequence (daily, weekly)' },
                                { flag: 'open-pull-requests-limit', desc: 'Limite de PR ouvertes' }
                            ],
                            examples: [
                                { code: '# .github/dependabot.yml\nversion: 2\nupdates:\n  - package-ecosystem: "npm"\n    directory: "/"\n    schedule:\n      interval: "weekly"\n    open-pull-requests-limit: 10\n    \n  - package-ecosystem: "docker"\n    directory: "/"\n    schedule:\n      interval: "weekly"\n    \n  - package-ecosystem: "github-actions"\n    directory: "/"\n    schedule:\n      interval: "weekly"', desc: 'Configuration complete' },
                                { code: '# Grouper les updates\nupdates:\n  - package-ecosystem: "npm"\n    groups:\n      dev-dependencies:\n        patterns:\n          - "*"\n        exclude-patterns:\n          - "react*"', desc: 'Grouping' }
                            ],
                            tips: ['Activez aussi les Security Alerts dans les settings'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Analyser licences',
                        desc: 'FOSSA, license-checker',
                        details: {
                            explanation: 'Verifie la conformite des licences de vos dependances.',
                            syntax: 'license-checker --production\nfossa analyze',
                            options: [
                                { flag: '--production', desc: 'Deps de production seulement' },
                                { flag: '--onlyAllow', desc: 'Licences autorisees' },
                                { flag: '--failOn', desc: 'Licences interdites' }
                            ],
                            examples: [
                                { code: '# license-checker (Node.js)\nnpx license-checker --production --onlyAllow "MIT;ISC;Apache-2.0;BSD-2-Clause;BSD-3-Clause"', desc: 'Node.js' },
                                { code: '# pip-licenses (Python)\npip install pip-licenses\npip-licenses --allow-only="MIT;BSD;Apache Software License"', desc: 'Python' },
                                { code: '# FOSSA CLI\nfossa analyze\nfossa test  # Check policy compliance', desc: 'FOSSA' }
                            ],
                            tips: ['Definissez une politique de licences acceptables'],
                            warnings: ['GPL peut etre problematique pour du code proprietaire']
                        }
                    },
                    {
                        cmd: 'Generer SBOM',
                        desc: 'syft, CycloneDX',
                        details: {
                            explanation: 'Software Bill of Materials - inventaire de tous les composants logiciels.',
                            syntax: 'syft . -o cyclonedx-json\ntrivy fs --format cyclonedx .',
                            options: [
                                { flag: 'cyclonedx-json', desc: 'Format CycloneDX JSON' },
                                { flag: 'spdx-json', desc: 'Format SPDX JSON' },
                                { flag: '-o, --output', desc: 'Fichier de sortie' }
                            ],
                            examples: [
                                { code: '# Syft (Anchore)\nsyft . -o cyclonedx-json > sbom.json\nsyft myimage:latest -o spdx-json > sbom-spdx.json', desc: 'Syft' },
                                { code: '# Trivy SBOM\ntrivy fs --format cyclonedx --output sbom.json .\ntrivy image --format spdx-json myapp:latest', desc: 'Trivy' },
                                { code: '# CycloneDX pour Node.js\nnpx @cyclonedx/cyclonedx-npm --output-file sbom.json', desc: 'CycloneDX CLI' }
                            ],
                            tips: ['SBOM est requis pour la conformite supply chain (ex: EO 14028)'],
                            warnings: []
                        }
                    }
                ]
            },
            {
                id: 'secrets-mgmt',
                title: 'üîë Gerer mes Secrets',
                icon: 'fa-key',
                color: 'border-l-4 border-yellow-500',
                commands: [
                    {
                        cmd: 'Detecter les secrets',
                        desc: 'gitleaks, truffleHog',
                        details: {
                            explanation: 'Scanne le code et l\'historique Git pour trouver des secrets commites accidentellement.',
                            syntax: 'gitleaks detect --source .\ntrufflehog git file://.',
                            options: [
                                { flag: 'detect', desc: 'Scan le repo' },
                                { flag: 'protect', desc: 'Pre-commit hook' },
                                { flag: '--no-git', desc: 'Sans historique Git' },
                                { flag: '-v', desc: 'Verbose output' }
                            ],
                            examples: [
                                { code: '# Gitleaks\ngitleaks detect --source . -v\ngitleaks detect --source . --report-format sarif --report-path gitleaks.sarif', desc: 'Gitleaks scan' },
                                { code: '# Pre-commit hook\nrepos:\n  - repo: https://github.com/gitleaks/gitleaks\n    rev: v8.18.0\n    hooks:\n      - id: gitleaks', desc: 'Pre-commit' },
                                { code: '# TruffleHog\ntrufflehog git file://. --only-verified\ntrufflehog github --org=myorg', desc: 'TruffleHog' }
                            ],
                            tips: ['Utilisez pre-commit hooks pour bloquer les commits avec secrets'],
                            warnings: ['Si un secret est commite, considerez-le compromis et rotez-le']
                        }
                    },
                    {
                        cmd: 'Utiliser Vault',
                        desc: 'HashiCorp Vault, policies',
                        details: {
                            explanation: 'HashiCorp Vault centralise et securise la gestion des secrets.',
                            syntax: 'vault kv get secret/myapp\nvault kv put secret/myapp key=value',
                            options: [
                                { flag: 'kv get', desc: 'Lire un secret' },
                                { flag: 'kv put', desc: 'Ecrire un secret' },
                                { flag: 'kv list', desc: 'Lister les secrets' },
                                { flag: 'policy write', desc: 'Creer une policy' }
                            ],
                            examples: [
                                { code: '# Authentification\nexport VAULT_ADDR="https://vault.example.com"\nvault login -method=token\n\n# Lire/Ecrire\nvault kv get secret/myapp/db\nvault kv put secret/myapp/db password="s3cr3t"', desc: 'CLI basique' },
                                { code: '# Policy\npath "secret/data/myapp/*" {\n  capabilities = ["read", "list"]\n}\n\nvault policy write myapp-read myapp-policy.hcl', desc: 'Policy' },
                                { code: '# Dynamic secrets (DB)\nvault read database/creds/myapp-role', desc: 'Dynamic secrets' }
                            ],
                            tips: ['Utilisez des dynamic secrets quand possible', 'Configurez l\'audit logging'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Secrets GitHub/GitLab',
                        desc: 'secrets, masked variables',
                        details: {
                            explanation: 'Stocke et utilise des secrets dans les pipelines CI/CD.',
                            syntax: '${{ secrets.MY_SECRET }}\n$MY_SECRET',
                            options: [
                                { flag: 'Repository secrets', desc: 'Secrets niveau repo' },
                                { flag: 'Environment secrets', desc: 'Secrets par environnement' },
                                { flag: 'Organization secrets', desc: 'Partages entre repos' }
                            ],
                            examples: [
                                { code: '# GitHub Actions\nsteps:\n  - name: Deploy\n    env:\n      API_KEY: ${{ secrets.API_KEY }}\n      DB_PASSWORD: ${{ secrets.DB_PASSWORD }}\n    run: ./deploy.sh', desc: 'GitHub Actions' },
                                { code: '# GitLab CI\nvariables:\n  DB_PASSWORD: $DB_PASSWORD  # From CI/CD settings\n\ndeploy:\n  script:\n    - echo $DB_PASSWORD | docker login -u user --password-stdin', desc: 'GitLab CI' },
                                { code: '# Environment protection\njobs:\n  deploy-prod:\n    environment: production\n    steps:\n      - run: echo ${{ secrets.PROD_API_KEY }}', desc: 'Environment secrets' }
                            ],
                            tips: ['Utilisez des environments pour separer dev/staging/prod'],
                            warnings: ['Les secrets sont masques dans les logs mais pas chiffres en memoire']
                        }
                    },
                    {
                        cmd: 'Rotater les secrets',
                        desc: 'rotation automatique',
                        details: {
                            explanation: 'Change regulierement les secrets pour limiter l\'impact d\'une compromission.',
                            syntax: 'vault write -f database/rotate-root/mydb',
                            options: [
                                { flag: 'Rotation manuelle', desc: 'Scripts de rotation' },
                                { flag: 'Rotation automatique', desc: 'Vault, AWS Secrets Manager' }
                            ],
                            examples: [
                                { code: '# AWS Secrets Manager\naws secretsmanager rotate-secret --secret-id MySecret\n\n# Configuration rotation\n{\n  "RotationLambdaARN": "arn:aws:lambda:...",\n  "RotationRules": {\n    "AutomaticallyAfterDays": 30\n  }\n}', desc: 'AWS' },
                                { code: '# Vault auto-rotation\nvault write database/config/mydb \\\n  connection_url="..." \\\n  username="..." \\\n  password="..." \\\n  rotation_period="24h"', desc: 'Vault' },
                                { code: '# Script de rotation\n#!/bin/bash\nNEW_PASSWORD=$(openssl rand -base64 32)\nvault kv put secret/myapp password="$NEW_PASSWORD"\nkubectl create secret generic myapp --from-literal=password="$NEW_PASSWORD" --dry-run=client -o yaml | kubectl apply -f -', desc: 'Script custom' }
                            ],
                            tips: ['Automatisez la rotation autant que possible'],
                            warnings: ['Testez la rotation en staging avant production']
                        }
                    },
                    {
                        cmd: 'Audit des acces',
                        desc: 'logs, alerting',
                        details: {
                            explanation: 'Tracez qui accede aux secrets et quand.',
                            syntax: 'vault audit enable file file_path=/var/log/vault_audit.log',
                            options: [
                                { flag: 'audit enable', desc: 'Active l\'audit' },
                                { flag: 'file', desc: 'Logs vers fichier' },
                                { flag: 'syslog', desc: 'Logs vers syslog' }
                            ],
                            examples: [
                                { code: '# Vault audit\nvault audit enable file file_path=/var/log/vault_audit.log\nvault audit list', desc: 'Vault audit' },
                                { code: '# AWS CloudTrail\n{\n  "eventSource": "secretsmanager.amazonaws.com",\n  "eventName": "GetSecretValue"\n}', desc: 'AWS CloudTrail' },
                                { code: '# Alerting (exemple)\nif grep -q "GetSecretValue.*CRITICAL_SECRET" /var/log/vault_audit.log; then\n  send_alert "Secret access detected"\nfi', desc: 'Alerting' }
                            ],
                            tips: ['Envoyez les logs vers un SIEM pour correlation'],
                            warnings: []
                        }
                    }
                ]
            },
            {
                id: 'container-security',
                title: 'üê≥ Securiser mes Conteneurs',
                icon: 'fa-docker',
                color: 'border-l-4 border-cyan-500',
                commands: [
                    {
                        cmd: 'Scanner images avec Trivy',
                        desc: 'trivy image, CVE',
                        details: {
                            explanation: 'Detecte les vulnerabilites (CVE) dans les images Docker.',
                            syntax: 'trivy image myimage:latest',
                            options: [
                                { flag: '--severity', desc: 'Filtrer par severite' },
                                { flag: '--ignore-unfixed', desc: 'Ignorer CVE sans fix' },
                                { flag: '--exit-code 1', desc: 'Fail si vulnerabilites' },
                                { flag: '--format sarif', desc: 'Output SARIF' }
                            ],
                            examples: [
                                { code: '# Scan basique\ntrivy image myapp:latest\n\n# Production\ntrivy image --severity HIGH,CRITICAL --ignore-unfixed myapp:latest', desc: 'CLI' },
                                { code: '# CI/CD\ntrivy image --exit-code 1 --severity CRITICAL --ignore-unfixed $IMAGE', desc: 'CI blocking' },
                                { code: '# GitHub Actions\n- name: Trivy scan\n  uses: aquasecurity/trivy-action@master\n  with:\n    image-ref: myapp:latest\n    format: sarif\n    output: trivy-results.sarif\n    severity: HIGH,CRITICAL', desc: 'GitHub Actions' }
                            ],
                            tips: ['Scannez avant chaque push vers le registry'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Analyser avec Docker Scout',
                        desc: 'docker scout cves',
                        details: {
                            explanation: 'Docker Scout est l\'outil natif de Docker pour analyser les images.',
                            syntax: 'docker scout cves myimage:latest\ndocker scout recommendations myimage:latest',
                            options: [
                                { flag: 'cves', desc: 'Liste les CVE' },
                                { flag: 'quickview', desc: 'Resume rapide' },
                                { flag: 'recommendations', desc: 'Suggestions de remediation' }
                            ],
                            examples: [
                                { code: '# Scan\ndocker scout cves myapp:latest\ndocker scout quickview myapp:latest', desc: 'Scan basique' },
                                { code: '# Comparaison\ndocker scout compare myapp:latest myapp:previous', desc: 'Compare versions' },
                                { code: '# SBOM\ndocker scout sbom myapp:latest', desc: 'Generer SBOM' }
                            ],
                            tips: ['Integre avec Docker Desktop pour une vue graphique'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Hardening Dockerfile',
                        desc: 'USER non-root, COPY vs ADD',
                        details: {
                            explanation: 'Bonnes pratiques pour securiser vos Dockerfiles.',
                            syntax: 'FROM base AS builder\nUSER nonroot',
                            options: [
                                { flag: 'USER', desc: 'Executer en non-root' },
                                { flag: 'COPY', desc: 'Preferer a ADD' },
                                { flag: 'multi-stage', desc: 'Reduire la surface d\'attaque' }
                            ],
                            examples: [
                                { code: '# Dockerfile securise\nFROM python:3.11-slim AS builder\nWORKDIR /app\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\n\nFROM python:3.11-slim\nRUN useradd -m -u 1000 appuser\nWORKDIR /app\nCOPY --from=builder /usr/local/lib/python3.11/site-packages /usr/local/lib/python3.11/site-packages\nCOPY --chown=appuser:appuser . .\nUSER appuser\nCMD ["python", "app.py"]', desc: 'Multi-stage non-root' },
                                { code: '# Distroless (Google)\nFROM gcr.io/distroless/python3-debian11\nCOPY --from=builder /app /app\nUSER nonroot\nCMD ["app.py"]', desc: 'Distroless' },
                                { code: '# Hadolint (linter)\nhadolint Dockerfile\nhadolint --ignore DL3008 Dockerfile', desc: 'Lint Dockerfile' }
                            ],
                            tips: ['Utilisez des images distroless ou scratch quand possible'],
                            warnings: ['Evitez ADD sauf pour extraire des archives']
                        }
                    },
                    {
                        cmd: 'Signer les images',
                        desc: 'cosign, Notary',
                        details: {
                            explanation: 'Signe cryptographiquement les images pour garantir leur integrite.',
                            syntax: 'cosign sign myregistry/myimage:latest\ncosign verify myregistry/myimage:latest',
                            options: [
                                { flag: 'sign', desc: 'Signer une image' },
                                { flag: 'verify', desc: 'Verifier la signature' },
                                { flag: '--key', desc: 'Cle privee' }
                            ],
                            examples: [
                                { code: '# Generer cles\ncosign generate-key-pair\n\n# Signer\ncosign sign --key cosign.key myregistry/myimage:latest\n\n# Verifier\ncosign verify --key cosign.pub myregistry/myimage:latest', desc: 'Cosign basique' },
                                { code: '# Keyless (Sigstore)\nCOSIGN_EXPERIMENTAL=1 cosign sign myregistry/myimage:latest\n\n# Verifier keyless\ncosign verify --certificate-identity=user@example.com --certificate-oidc-issuer=https://accounts.google.com myregistry/myimage:latest', desc: 'Keyless signing' },
                                { code: '# CI/CD\n- name: Sign image\n  run: |\n    cosign sign --key env://COSIGN_KEY ${{ env.REGISTRY }}/${{ env.IMAGE }}:${{ github.sha }}', desc: 'CI signing' }
                            ],
                            tips: ['Utilisez keyless signing avec Sigstore pour simplifier'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Runtime security',
                        desc: 'Falco, seccomp',
                        details: {
                            explanation: 'Detecte les comportements suspects au runtime des conteneurs.',
                            syntax: 'falco -r /etc/falco/falco_rules.yaml',
                            options: [
                                { flag: 'Falco', desc: 'Detection runtime' },
                                { flag: 'seccomp', desc: 'Filtrage syscalls' },
                                { flag: 'AppArmor', desc: 'Confinement' }
                            ],
                            examples: [
                                { code: '# Falco rule\n- rule: Shell in container\n  desc: Detect shell in container\n  condition: container and proc.name in (bash, sh)\n  output: "Shell spawned in container (user=%user.name container=%container.name)"\n  priority: WARNING', desc: 'Falco rule' },
                                { code: '# Seccomp profile\n{\n  "defaultAction": "SCMP_ACT_ERRNO",\n  "syscalls": [\n    {\n      "names": ["read", "write", "exit"],\n      "action": "SCMP_ACT_ALLOW"\n    }\n  ]\n}', desc: 'Seccomp' },
                                { code: '# Docker avec seccomp\ndocker run --security-opt seccomp=profile.json myimage', desc: 'Docker seccomp' }
                            ],
                            tips: ['Falco peut alerter sur des comportements anormaux en temps reel'],
                            warnings: []
                        }
                    }
                ]
            },
            {
                id: 'dast-api',
                title: 'üåê Tester mes APIs (DAST)',
                icon: 'fa-globe',
                color: 'border-l-4 border-purple-500',
                commands: [
                    {
                        cmd: 'Scanner avec ZAP',
                        desc: 'zap-baseline, zap-full-scan',
                        details: {
                            explanation: 'OWASP ZAP scanne les applications web pour detecter les vulnerabilites.',
                            syntax: 'zap-baseline.py -t https://target.com\nzap-full-scan.py -t https://target.com',
                            options: [
                                { flag: 'baseline', desc: 'Scan rapide passif' },
                                { flag: 'full-scan', desc: 'Scan complet actif' },
                                { flag: '-t', desc: 'URL cible' },
                                { flag: '-r', desc: 'Rapport HTML' }
                            ],
                            examples: [
                                { code: '# Docker baseline\ndocker run -t owasp/zap2docker-stable zap-baseline.py \\\n  -t https://myapp.example.com \\\n  -r report.html', desc: 'Baseline scan' },
                                { code: '# Full scan\ndocker run -t owasp/zap2docker-stable zap-full-scan.py \\\n  -t https://myapp.example.com \\\n  -r report.html \\\n  -J report.json', desc: 'Full scan' },
                                { code: '# GitHub Actions\n- name: ZAP Scan\n  uses: zaproxy/action-baseline@v0.9.0\n  with:\n    target: https://myapp.example.com\n    rules_file_name: .zap/rules.tsv', desc: 'GitHub Actions' }
                            ],
                            tips: ['Baseline pour CI, full-scan pour tests periodiques approfondis'],
                            warnings: ['Ne scannez que les environnements autorises!']
                        }
                    },
                    {
                        cmd: 'Fuzzer avec Nuclei',
                        desc: 'nuclei -t, templates',
                        details: {
                            explanation: 'Nuclei execute des templates de detection de vulnerabilites.',
                            syntax: 'nuclei -u https://target.com -t templates/',
                            options: [
                                { flag: '-u', desc: 'URL cible' },
                                { flag: '-t', desc: 'Templates a utiliser' },
                                { flag: '-severity', desc: 'Filtrer par severite' },
                                { flag: '-o', desc: 'Output file' }
                            ],
                            examples: [
                                { code: '# Scan avec templates\nnuclei -u https://myapp.example.com -t cves/\nnuclei -u https://myapp.example.com -t exposures/ -t vulnerabilities/', desc: 'Templates specifiques' },
                                { code: '# Par severite\nnuclei -u https://myapp.example.com -severity critical,high -o findings.txt', desc: 'Filtrer severite' },
                                { code: '# Template custom\nid: my-api-check\ninfo:\n  name: Custom API Check\n  severity: medium\nrequests:\n  - method: GET\n    path:\n      - "/api/admin"\n    matchers:\n      - type: status\n        status:\n          - 200', desc: 'Template custom' }
                            ],
                            tips: ['Nuclei est plus rapide que ZAP pour des checks specifiques'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Tester OWASP Top 10',
                        desc: 'injection, XSS, auth',
                        details: {
                            explanation: 'Testez les vulnerabilites les plus courantes selon OWASP.',
                            syntax: 'Tests manuels et automatises',
                            options: [
                                { flag: 'A01', desc: 'Broken Access Control' },
                                { flag: 'A02', desc: 'Cryptographic Failures' },
                                { flag: 'A03', desc: 'Injection' },
                                { flag: 'A07', desc: 'Auth Failures' }
                            ],
                            examples: [
                                { code: '# SQL Injection test\ncurl "https://api.example.com/users?id=1\' OR 1=1--"\n\n# Commando injection\ncurl -X POST -d "file=test; cat /etc/passwd" https://api.example.com/upload', desc: 'Injection' },
                                { code: '# IDOR test\ncurl -H "Authorization: Bearer $TOKEN_USER_A" \\\n  https://api.example.com/users/USER_B_ID', desc: 'Broken Access Control' },
                                { code: '# XSS test\ncurl "https://example.com/search?q=<script>alert(1)<\/script>"', desc: 'XSS' }
                            ],
                            tips: ['Utilisez Burp Suite pour les tests manuels approfondis'],
                            warnings: ['Obtenez toujours l\'autorisation avant de tester']
                        }
                    },
                    {
                        cmd: 'Automatiser les tests',
                        desc: 'CI integration',
                        details: {
                            explanation: 'Integre les tests DAST dans le pipeline CI/CD.',
                            syntax: 'Pipeline CI avec ZAP ou Nuclei',
                            options: [
                                { flag: 'Staging', desc: 'Tester en pre-prod' },
                                { flag: 'Baseline', desc: 'Tests rapides dans CI' },
                                { flag: 'Scheduled', desc: 'Full scans periodiques' }
                            ],
                            examples: [
                                { code: '# GitHub Actions DAST\nname: DAST\non:\n  schedule:\n    - cron: "0 2 * * 1"  # Hebdomadaire\njobs:\n  zap-scan:\n    runs-on: ubuntu-latest\n    steps:\n      - name: ZAP Full Scan\n        uses: zaproxy/action-full-scan@v0.7.0\n        with:\n          target: https://staging.example.com', desc: 'Scheduled scan' },
                                { code: '# GitLab DAST\ndast:\n  stage: test\n  image: owasp/zap2docker-stable\n  script:\n    - zap-baseline.py -t $STAGING_URL -r zap-report.html\n  artifacts:\n    paths:\n      - zap-report.html', desc: 'GitLab CI' }
                            ],
                            tips: ['DAST sur staging, jamais directement en prod sans autorisation'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Generer rapports',
                        desc: 'HTML, SARIF, JSON',
                        details: {
                            explanation: 'Exportez les resultats dans differents formats pour analyse et tracking.',
                            syntax: 'zap-baseline.py -r report.html -J report.json',
                            options: [
                                { flag: '-r', desc: 'Rapport HTML' },
                                { flag: '-J', desc: 'Rapport JSON' },
                                { flag: '-x', desc: 'Rapport XML' },
                                { flag: 'SARIF', desc: 'Pour GitHub Security' }
                            ],
                            examples: [
                                { code: '# Multi-format\nzap-baseline.py -t $URL -r report.html -J report.json -x report.xml', desc: 'ZAP multi-format' },
                                { code: '# Nuclei SARIF\nnuclei -u $URL -t cves/ -sarif -o results.sarif', desc: 'Nuclei SARIF' },
                                { code: '# Upload to GitHub\n- uses: github/codeql-action/upload-sarif@v2\n  with:\n    sarif_file: results.sarif', desc: 'GitHub upload' }
                            ],
                            tips: ['SARIF integre avec GitHub Security tab'],
                            warnings: []
                        }
                    }
                ]
            },
            {
                id: 'iac-security',
                title: 'üèóÔ∏è Auditer mon Infrastructure (IaC)',
                icon: 'fa-server',
                color: 'border-l-4 border-orange-500',
                commands: [
                    {
                        cmd: 'Scanner Terraform',
                        desc: 'tfsec, checkov',
                        details: {
                            explanation: 'Detecte les misconfigurations de securite dans le code Terraform.',
                            syntax: 'tfsec .\ncheckov -d .',
                            options: [
                                { flag: '--format', desc: 'Format output (sarif, json)' },
                                { flag: '--soft-fail', desc: 'Ne pas echouer le build' },
                                { flag: '--skip-check', desc: 'Ignorer certains checks' }
                            ],
                            examples: [
                                { code: '# tfsec\ntfsec .\ntfsec --format sarif > tfsec.sarif', desc: 'tfsec' },
                                { code: '# Checkov\ncheckov -d . --framework terraform\ncheckov -d . --skip-check CKV_AWS_123', desc: 'Checkov' },
                                { code: '# GitHub Actions\n- name: tfsec\n  uses: aquasecurity/tfsec-action@v1.0.0\n  with:\n    soft_fail: true', desc: 'CI Integration' }
                            ],
                            tips: ['Utilisez les deux pour une couverture maximale'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Auditer CloudFormation',
                        desc: 'cfn-lint, cfn-nag',
                        details: {
                            explanation: 'Valide et securise les templates CloudFormation AWS.',
                            syntax: 'cfn-lint template.yaml\ncfn_nag_scan --input-path template.yaml',
                            options: [
                                { flag: 'cfn-lint', desc: 'Validation syntaxe et best practices' },
                                { flag: 'cfn_nag', desc: 'Checks de securite' }
                            ],
                            examples: [
                                { code: '# cfn-lint\npip install cfn-lint\ncfn-lint template.yaml', desc: 'cfn-lint' },
                                { code: '# cfn_nag\ngem install cfn-nag\ncfn_nag_scan --input-path template.yaml', desc: 'cfn_nag' },
                                { code: '# Checkov CFN\ncheckov -d . --framework cloudformation', desc: 'Checkov' }
                            ],
                            tips: ['cfn-lint pour la syntaxe, cfn_nag pour la securite'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Verifier Kubernetes YAML',
                        desc: 'kubesec, kube-linter',
                        details: {
                            explanation: 'Analyse les manifests Kubernetes pour les problemes de securite.',
                            syntax: 'kubesec scan deployment.yaml\nkube-linter lint .',
                            options: [
                                { flag: 'kubesec', desc: 'Score de securite' },
                                { flag: 'kube-linter', desc: 'Best practices K8s' },
                                { flag: 'kube-score', desc: 'Score qualite' }
                            ],
                            examples: [
                                { code: '# Kubesec\nkubesec scan deployment.yaml\nkubesec scan deployment.yaml --format json', desc: 'Kubesec' },
                                { code: '# Kube-linter\nkube-linter lint manifests/\nkube-linter lint manifests/ --config .kube-linter.yaml', desc: 'Kube-linter' },
                                { code: '# Checkov K8s\ncheckov -d manifests/ --framework kubernetes', desc: 'Checkov' }
                            ],
                            tips: ['Integrez dans le CI pour bloquer les configs non securisees'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Analyser Ansible',
                        desc: 'ansible-lint',
                        details: {
                            explanation: 'Verifie les playbooks Ansible pour les erreurs et best practices.',
                            syntax: 'ansible-lint playbook.yml',
                            options: [
                                { flag: '-p', desc: 'Parseable output' },
                                { flag: '--profile', desc: 'Profil (production, shared)' },
                                { flag: '-x', desc: 'Skip rules' }
                            ],
                            examples: [
                                { code: '# Lint basique\nansible-lint playbook.yml\nansible-lint --profile production .', desc: 'ansible-lint' },
                                { code: '# Configuration .ansible-lint\nprofile: production\nskip_list:\n  - yaml[line-length]\nwarn_list:\n  - experimental', desc: 'Config file' },
                                { code: '# Pre-commit\n- repo: https://github.com/ansible/ansible-lint\n  rev: v6.17.0\n  hooks:\n    - id: ansible-lint', desc: 'Pre-commit' }
                            ],
                            tips: ['Utilisez le profil production pour les checks stricts'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Politiques avec OPA',
                        desc: 'Rego, Conftest',
                        details: {
                            explanation: 'Open Policy Agent permet de definir des politiques de securite comme code.',
                            syntax: 'conftest test deployment.yaml\nopa eval -d policy.rego -i input.json',
                            options: [
                                { flag: 'conftest', desc: 'CLI pour tester avec OPA' },
                                { flag: 'opa eval', desc: 'Evaluation OPA directe' },
                                { flag: 'Rego', desc: 'Langage de policy' }
                            ],
                            examples: [
                                { code: '# Conftest\nconftest test deployment.yaml\nconftest test --policy ./policies deployment.yaml', desc: 'Conftest' },
                                { code: '# Policy Rego\npackage main\n\ndeny[msg] {\n  input.kind == "Deployment"\n  not input.spec.template.spec.securityContext.runAsNonRoot\n  msg := "Containers must run as non-root"\n}', desc: 'Rego policy' },
                                { code: '# Test\nconftest test -p policy/ k8s/\nconftest verify -p policy/  # Test des policies', desc: 'Usage' }
                            ],
                            tips: ['OPA/Conftest unifie les policies pour Terraform, K8s, Docker'],
                            warnings: []
                        }
                    }
                ]
            },
            {
                id: 'k8s-security',
                title: '‚ò∏Ô∏è Securiser Kubernetes',
                icon: 'fa-dharmachakra',
                color: 'border-l-4 border-indigo-500',
                commands: [
                    {
                        cmd: 'Scanner cluster',
                        desc: 'kubescape, kube-bench',
                        details: {
                            explanation: 'Evalue la securite du cluster Kubernetes contre les benchmarks.',
                            syntax: 'kubescape scan framework nsa\nkube-bench run',
                            options: [
                                { flag: 'kubescape', desc: 'Multi-framework (NSA, MITRE)' },
                                { flag: 'kube-bench', desc: 'CIS Benchmark' }
                            ],
                            examples: [
                                { code: '# Kubescape\nkubescape scan framework nsa --enable-host-scan\nkubescape scan framework mitre', desc: 'Kubescape' },
                                { code: '# Kube-bench (CIS)\nkube-bench run --targets master,node\nkube-bench run --benchmark cis-1.8', desc: 'Kube-bench' },
                                { code: '# CI/CD\n- name: Kubescape\n  uses: kubescape/github-action@main\n  with:\n    format: sarif\n    outputFile: results.sarif', desc: 'GitHub Actions' }
                            ],
                            tips: ['Kubescape pour une vue globale, kube-bench pour CIS compliance'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Network Policies',
                        desc: 'deny-all, allow specific',
                        details: {
                            explanation: 'Controle le trafic reseau entre les pods avec des Network Policies.',
                            syntax: 'kubectl apply -f network-policy.yaml',
                            options: [
                                { flag: 'Ingress', desc: 'Trafic entrant' },
                                { flag: 'Egress', desc: 'Trafic sortant' },
                                { flag: 'podSelector', desc: 'Pods cibles' }
                            ],
                            examples: [
                                { code: '# Deny all par defaut\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: deny-all\nspec:\n  podSelector: {}\n  policyTypes:\n    - Ingress\n    - Egress', desc: 'Deny all' },
                                { code: '# Allow specific\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-frontend\nspec:\n  podSelector:\n    matchLabels:\n      app: api\n  ingress:\n    - from:\n        - podSelector:\n            matchLabels:\n              app: frontend\n      ports:\n        - port: 8080', desc: 'Allow specific' }
                            ],
                            tips: ['Commencez par deny-all puis ajoutez les regles necessaires'],
                            warnings: ['Verifiez que votre CNI supporte les Network Policies']
                        }
                    },
                    {
                        cmd: 'Pod Security Standards',
                        desc: 'restricted, baseline',
                        details: {
                            explanation: 'Enforce les standards de securite pour les pods.',
                            syntax: 'kubectl label ns myns pod-security.kubernetes.io/enforce=restricted',
                            options: [
                                { flag: 'privileged', desc: 'Pas de restrictions' },
                                { flag: 'baseline', desc: 'Restrictions minimales' },
                                { flag: 'restricted', desc: 'Restrictions maximales' }
                            ],
                            examples: [
                                { code: '# Labeler un namespace\nkubectl label namespace myns \\\n  pod-security.kubernetes.io/enforce=restricted \\\n  pod-security.kubernetes.io/warn=restricted', desc: 'Apply PSS' },
                                { code: '# Pod compliant restricted\napiVersion: v1\nkind: Pod\nspec:\n  securityContext:\n    runAsNonRoot: true\n    seccompProfile:\n      type: RuntimeDefault\n  containers:\n    - name: app\n      securityContext:\n        allowPrivilegeEscalation: false\n        capabilities:\n          drop: ["ALL"]', desc: 'Pod restricted' }
                            ],
                            tips: ['Utilisez restricted pour les workloads de production'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'RBAC et Service Accounts',
                        desc: 'roles, bindings',
                        details: {
                            explanation: 'Controle les permissions avec Role-Based Access Control.',
                            syntax: 'kubectl create role --verb=get --resource=pods\nkubectl create rolebinding --role=NAME --serviceaccount=NS:SA',
                            options: [
                                { flag: 'Role', desc: 'Permissions namespace' },
                                { flag: 'ClusterRole', desc: 'Permissions cluster' },
                                { flag: 'RoleBinding', desc: 'Lie role a user/sa' }
                            ],
                            examples: [
                                { code: '# Role readonly\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: pod-reader\nrules:\n  - apiGroups: [""]\n    resources: ["pods"]\n    verbs: ["get", "list", "watch"]', desc: 'Role' },
                                { code: '# RoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: read-pods\nsubjects:\n  - kind: ServiceAccount\n    name: myapp\n    namespace: default\nroleRef:\n  kind: Role\n  name: pod-reader\n  apiGroup: rbac.authorization.k8s.io', desc: 'RoleBinding' },
                                { code: '# Audit RBAC\nkubectl auth can-i --list --as=system:serviceaccount:default:myapp', desc: 'Audit' }
                            ],
                            tips: ['Principe du moindre privilege - donnez le minimum necessaire'],
                            warnings: ['Evitez cluster-admin sauf absolument necessaire']
                        }
                    },
                    {
                        cmd: 'Admission Controllers',
                        desc: 'OPA Gatekeeper, Kyverno',
                        details: {
                            explanation: 'Valide et mute les ressources avant leur creation.',
                            syntax: 'kubectl apply -f constraint.yaml',
                            options: [
                                { flag: 'Gatekeeper', desc: 'OPA pour K8s' },
                                { flag: 'Kyverno', desc: 'Policies natives K8s' }
                            ],
                            examples: [
                                { code: '# Kyverno - require labels\napiVersion: kyverno.io/v1\nkind: ClusterPolicy\nmetadata:\n  name: require-labels\nspec:\n  validationFailureAction: enforce\n  rules:\n    - name: check-labels\n      match:\n        resources:\n          kinds: ["Pod"]\n      validate:\n        message: "Label app is required"\n        pattern:\n          metadata:\n            labels:\n              app: "?*"', desc: 'Kyverno policy' },
                                { code: '# Gatekeeper ConstraintTemplate\napiVersion: templates.gatekeeper.sh/v1\nkind: ConstraintTemplate\nmetadata:\n  name: k8srequiredlabels\nspec:\n  crd:\n    spec:\n      names:\n        kind: K8sRequiredLabels\n  targets:\n    - target: admission.k8s.gatekeeper.sh\n      rego: |\n        package k8srequiredlabels\n        violation[{"msg": msg}] {\n          not input.review.object.metadata.labels.app\n          msg := "Label app required"\n        }', desc: 'Gatekeeper' }
                            ],
                            tips: ['Kyverno est plus simple, Gatekeeper plus flexible'],
                            warnings: []
                        }
                    }
                ]
            },
            {
                id: 'secure-cicd',
                title: 'üîÑ Pipeline CI/CD Securise',
                icon: 'fa-infinity',
                color: 'border-l-4 border-pink-500',
                commands: [
                    {
                        cmd: 'Pipeline GitHub Actions securise',
                        desc: 'permissions, OIDC',
                        details: {
                            explanation: 'Securise les workflows GitHub Actions avec des permissions minimales.',
                            syntax: 'permissions:\n  contents: read',
                            options: [
                                { flag: 'permissions', desc: 'Permissions minimales' },
                                { flag: 'OIDC', desc: 'Auth sans secrets' },
                                { flag: 'environments', desc: 'Protection deployments' }
                            ],
                            examples: [
                                { code: '# Permissions minimales\nname: CI\non: push\npermissions:\n  contents: read\n  packages: write\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n        with:\n          persist-credentials: false', desc: 'Permissions' },
                                { code: '# OIDC pour AWS (sans secrets)\npermissions:\n  id-token: write\n  contents: read\nsteps:\n  - uses: aws-actions/configure-aws-credentials@v4\n    with:\n      role-to-assume: arn:aws:iam::123456789:role/GitHubActions\n      aws-region: eu-west-1', desc: 'OIDC AWS' },
                                { code: '# Environment protection\njobs:\n  deploy:\n    environment:\n      name: production\n      url: https://myapp.example.com\n    steps:\n      - run: ./deploy.sh', desc: 'Environment' }
                            ],
                            tips: ['Utilisez OIDC au lieu de secrets long-lived'],
                            warnings: ['Ne jamais utiliser permissions: write-all']
                        }
                    },
                    {
                        cmd: 'Pipeline GitLab CI securise',
                        desc: 'protected, masked',
                        details: {
                            explanation: 'Securise les pipelines GitLab CI avec variables protegees.',
                            syntax: 'variables:\n  DEPLOY_TOKEN: $DEPLOY_TOKEN',
                            options: [
                                { flag: 'Protected', desc: 'Branches protegees only' },
                                { flag: 'Masked', desc: 'Cache dans les logs' },
                                { flag: 'File', desc: 'Variable en fichier' }
                            ],
                            examples: [
                                { code: '# Variables securisees\nvariables:\n  DEPLOY_TOKEN:\n    value: $DEPLOY_TOKEN\n    description: "Token de deploiement"\n\ndeploy:\n  script:\n    - echo $DEPLOY_TOKEN | docker login -u user --password-stdin\n  rules:\n    - if: $CI_COMMIT_BRANCH == "main"\n      when: manual', desc: 'Variables' },
                                { code: '# Protected branches\ndeploy-prod:\n  stage: deploy\n  script:\n    - ./deploy.sh production\n  environment:\n    name: production\n  rules:\n    - if: $CI_COMMIT_REF_PROTECTED == "true"', desc: 'Protected' },
                                { code: '# ID tokens (OIDC)\ndeploy:\n  id_tokens:\n    AWS_TOKEN:\n      aud: https://gitlab.example.com\n  script:\n    - aws sts assume-role-with-web-identity ...', desc: 'OIDC' }
                            ],
                            tips: ['Marquez les variables sensibles comme Protected et Masked'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Gates de qualite',
                        desc: 'blocking on failures',
                        details: {
                            explanation: 'Bloque les deployments si les checks de securite echouent.',
                            syntax: 'exit 1 si vulnerabilites critiques',
                            options: [
                                { flag: 'SAST gate', desc: 'Bloquer sur findings' },
                                { flag: 'SCA gate', desc: 'Bloquer sur CVE critiques' },
                                { flag: 'Coverage gate', desc: 'Seuil de couverture' }
                            ],
                            examples: [
                                { code: '# Quality gates\njobs:\n  security-gate:\n    runs-on: ubuntu-latest\n    steps:\n      - name: SAST\n        run: semgrep scan --error --severity=ERROR .\n      \n      - name: SCA\n        run: trivy fs --exit-code 1 --severity CRITICAL .\n      \n      - name: Container scan\n        run: trivy image --exit-code 1 --severity CRITICAL $IMAGE', desc: 'Multi-gate' },
                                { code: '# SonarQube Quality Gate\n- name: Quality Gate\n  run: |\n    STATUS=$(curl -s -u $SONAR_TOKEN: "$SONAR_URL/api/qualitygates/project_status?projectKey=$PROJECT" | jq -r .projectStatus.status)\n    if [ "$STATUS" != "OK" ]; then\n      echo "Quality Gate failed"\n      exit 1\n    fi', desc: 'SonarQube gate' }
                            ],
                            tips: ['Configurez des seuils raisonnables pour eviter le blocage permanent'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Artifacts signes',
                        desc: 'attestations, provenance',
                        details: {
                            explanation: 'Signe les artifacts pour prouver leur provenance.',
                            syntax: 'cosign sign\nattestation create',
                            options: [
                                { flag: 'cosign', desc: 'Signature images' },
                                { flag: 'attestation', desc: 'Provenance SLSA' },
                                { flag: 'sigstore', desc: 'Keyless signing' }
                            ],
                            examples: [
                                { code: '# GitHub attestation\n- name: Attest Build Provenance\n  uses: actions/attest-build-provenance@v1\n  with:\n    subject-name: ghcr.io/${{ github.repository }}\n    subject-digest: ${{ steps.build.outputs.digest }}\n    push-to-registry: true', desc: 'GitHub attestation' },
                                { code: '# Cosign sign + attest\ncosign sign $IMAGE\ncosign attest --predicate sbom.json --type cyclonedx $IMAGE', desc: 'Cosign attest' },
                                { code: '# Verify provenance\ncosign verify-attestation --type slsaprovenance $IMAGE', desc: 'Verify' }
                            ],
                            tips: ['Les attestations permettent de verifier la chaine de build'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Supply chain security',
                        desc: 'SLSA levels',
                        details: {
                            explanation: 'SLSA (Supply chain Levels for Software Artifacts) definit des niveaux de securite.',
                            syntax: 'SLSA Level 1-4',
                            options: [
                                { flag: 'Level 1', desc: 'Documentation du build' },
                                { flag: 'Level 2', desc: 'Build service verifie' },
                                { flag: 'Level 3', desc: 'Source verifiee' },
                                { flag: 'Level 4', desc: 'Two-party review' }
                            ],
                            examples: [
                                { code: '# SLSA GitHub generator\n- uses: slsa-framework/slsa-github-generator/.github/workflows/generator_generic_slsa3.yml@v1.9.0\n  with:\n    base64-subjects: ${{ needs.build.outputs.hash }}\n    upload-assets: true', desc: 'SLSA Level 3' },
                                { code: '# Verify SLSA\nslsa-verifier verify-artifact myartifact \\\n  --provenance-path provenance.intoto.jsonl \\\n  --source-uri github.com/myorg/myrepo', desc: 'Verify provenance' },
                                { code: '# Checklist SLSA\n# Level 1: Build scripted\n# Level 2: Hosted build service\n# Level 3: Source retained, signed provenance\n# Level 4: 2-person review required', desc: 'Levels' }
                            ],
                            tips: ['Visez au minimum SLSA Level 2 pour les projets critiques'],
                            warnings: []
                        }
                    }
                ]
            },
            {
                id: 'monitor-alert',
                title: 'üìä Monitorer et Alerter',
                icon: 'fa-bell',
                color: 'border-l-4 border-red-500',
                commands: [
                    {
                        cmd: 'Dashboard securite',
                        desc: 'DefectDojo, OWASP Dependency-Track',
                        details: {
                            explanation: 'Centralise et visualise les findings de securite.',
                            syntax: 'Import SARIF/JSON vers dashboard',
                            options: [
                                { flag: 'DefectDojo', desc: 'Gestion des vulns' },
                                { flag: 'Dependency-Track', desc: 'Suivi SCA/SBOM' }
                            ],
                            examples: [
                                { code: '# DefectDojo import\ncurl -X POST "$DEFECTDOJO_URL/api/v2/import-scan/" \\\n  -H "Authorization: Token $DD_TOKEN" \\\n  -F "scan_type=SARIF" \\\n  -F "file=@results.sarif" \\\n  -F "engagement=$ENGAGEMENT_ID"', desc: 'DefectDojo' },
                                { code: '# Dependency-Track\ncurl -X PUT "$DT_URL/api/v1/bom" \\\n  -H "X-Api-Key: $DT_API_KEY" \\\n  -H "Content-Type: application/vnd.cyclonedx+json" \\\n  -d @sbom.json', desc: 'Dependency-Track' },
                                { code: '# GitHub Security dashboard\n# Utilise automatiquement les SARIF uploades\n# Settings > Security > Code scanning alerts', desc: 'GitHub Security' }
                            ],
                            tips: ['DefectDojo pour aggreger tous les scans, D-Track pour les deps'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Centraliser les alertes',
                        desc: 'Slack, PagerDuty',
                        details: {
                            explanation: 'Envoie des alertes vers les canaux de communication.',
                            syntax: 'Webhook vers Slack/PagerDuty',
                            options: [
                                { flag: 'Slack', desc: 'Channel notifications' },
                                { flag: 'PagerDuty', desc: 'On-call alerting' },
                                { flag: 'email', desc: 'Notifications email' }
                            ],
                            examples: [
                                { code: '# Slack webhook\ncurl -X POST $SLACK_WEBHOOK \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "text": "üö® Critical vulnerability found",\n    "blocks": [{\n      "type": "section",\n      "text": {"type": "mrkdwn", "text": "*CVE-2024-1234* in myapp:latest"}\n    }]\n  }\'', desc: 'Slack alert' },
                                { code: '# GitHub Actions Slack\n- uses: slackapi/slack-github-action@v1.24.0\n  with:\n    channel-id: security-alerts\n    slack-message: "Security scan found ${{ steps.scan.outputs.count }} issues"', desc: 'GHA Slack' },
                                { code: '# PagerDuty\ncurl -X POST "https://events.pagerduty.com/v2/enqueue" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "routing_key": "$PD_ROUTING_KEY",\n    "event_action": "trigger",\n    "payload": {\n      "summary": "Critical CVE detected",\n      "severity": "critical",\n      "source": "security-scanner"\n    }\n  }\'', desc: 'PagerDuty' }
                            ],
                            tips: ['Filtrez par severite pour eviter l\'alert fatigue'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Metriques de securite',
                        desc: 'MTTR, SLA',
                        details: {
                            explanation: 'Mesure et suit les KPIs de securite.',
                            syntax: 'Dashboards Grafana/Datadog',
                            options: [
                                { flag: 'MTTR', desc: 'Mean Time to Remediate' },
                                { flag: 'MTTD', desc: 'Mean Time to Detect' },
                                { flag: 'SLA', desc: 'Delais de remediation' }
                            ],
                            examples: [
                                { code: '# SLA recommandes\n# Critical: 24h\n# High: 7 jours\n# Medium: 30 jours\n# Low: 90 jours', desc: 'SLA types' },
                                { code: '# Metriques a suivre\n# - Nombre de vulns par severite\n# - Age moyen des vulns\n# - MTTR par severite\n# - % de couverture des scans\n# - Taux de faux positifs', desc: 'KPIs' },
                                { code: '# Query exemple (DefectDojo API)\ncurl "$DD_URL/api/v2/findings/?severity=Critical&active=true" | \\\n  jq \'[.results[] | .created] | length\'', desc: 'Query vulns' }
                            ],
                            tips: ['Trackez MTTR pour mesurer l\'amelioration dans le temps'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Audit logs',
                        desc: 'CloudTrail, Audit logs',
                        details: {
                            explanation: 'Collecte et analyse les logs d\'audit pour la securite.',
                            syntax: 'CloudTrail, K8s audit, GitHub audit log',
                            options: [
                                { flag: 'CloudTrail', desc: 'AWS API calls' },
                                { flag: 'K8s audit', desc: 'API server audit' },
                                { flag: 'GitHub audit', desc: 'Org activity' }
                            ],
                            examples: [
                                { code: '# CloudTrail query\naws cloudtrail lookup-events \\\n  --lookup-attributes AttributeKey=EventName,AttributeValue=DeleteBucket', desc: 'CloudTrail' },
                                { code: '# K8s audit policy\napiVersion: audit.k8s.io/v1\nkind: Policy\nrules:\n  - level: Metadata\n    resources:\n      - group: ""\n        resources: ["secrets"]\n    verbs: ["get", "list"]', desc: 'K8s audit' },
                                { code: '# GitHub audit log\ngh api /orgs/myorg/audit-log --paginate | \\\n  jq \'.[] | select(.action | startswith("repo."))\'', desc: 'GitHub audit' }
                            ],
                            tips: ['Envoyez les audit logs vers un SIEM pour correlation'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Incident response',
                        desc: 'runbooks, playbooks',
                        details: {
                            explanation: 'Procedures documentees pour repondre aux incidents de securite.',
                            syntax: 'Runbooks markdown/wiki',
                            options: [
                                { flag: 'Runbook', desc: 'Procedure step-by-step' },
                                { flag: 'Playbook', desc: 'Procedure automatisee' },
                                { flag: 'Postmortem', desc: 'Analyse post-incident' }
                            ],
                            examples: [
                                { code: '# Runbook: Secret expose\n## Detection\n- Alerte gitleaks/GitHub\n\n## Containment\n1. Revoquer le secret immediatement\n2. Verifier les logs d\'acces\n\n## Eradication\n1. Rotater le secret\n2. Mettre a jour les configs\n\n## Recovery\n1. Deployer avec nouveau secret\n2. Verifier fonctionnement\n\n## Lessons learned\n- Ajouter pre-commit hook', desc: 'Runbook' },
                                { code: '# Playbook automatise\nname: secret-leak-response\ntrigger: gitleaks-alert\nsteps:\n  - revoke_credential:\n      provider: $PROVIDER\n      credential_id: $CRED_ID\n  - notify:\n      channel: security-incidents\n      message: "Secret revoked: $CRED_ID"\n  - create_ticket:\n      title: "Secret leak - rotation needed"', desc: 'Playbook' }
                            ],
                            tips: ['Testez les runbooks regulierement avec des exercices'],
                            warnings: []
                        }
                    }
                ]
            },
            {
                id: 'project-pipeline',
                title: 'üéØ Projet: Pipeline DevSecOps Complet',
                icon: 'fa-project-diagram',
                color: 'border-l-4 border-emerald-500',
                commands: [
                    {
                        cmd: 'Etape 1: Pre-commit hooks',
                        desc: 'gitleaks, semgrep',
                        details: {
                            explanation: 'Bloque les problemes de securite avant le commit.',
                            syntax: 'pre-commit install\npre-commit run --all-files',
                            options: [],
                            examples: [
                                { code: '# .pre-commit-config.yaml\nrepos:\n  - repo: https://github.com/gitleaks/gitleaks\n    rev: v8.18.0\n    hooks:\n      - id: gitleaks\n  \n  - repo: https://github.com/returntocorp/semgrep\n    rev: v1.45.0\n    hooks:\n      - id: semgrep\n        args: ["--config", "auto", "--error"]\n  \n  - repo: https://github.com/hadolint/hadolint\n    rev: v2.12.0\n    hooks:\n      - id: hadolint-docker', desc: 'Pre-commit config' },
                                { code: '# Installation\npip install pre-commit\npre-commit install\npre-commit run --all-files  # Test', desc: 'Setup' }
                            ],
                            tips: ['Pre-commit bloque les erreurs avant qu\'elles n\'entrent dans l\'historique'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Etape 2: Build securise',
                        desc: 'SAST, linting',
                        details: {
                            explanation: 'Analyse statique du code pendant le build.',
                            syntax: 'CI job avec semgrep, bandit, eslint',
                            options: [],
                            examples: [
                                { code: '# Stage SAST\nsast:\n  stage: build\n  parallel:\n    matrix:\n      - SCANNER: [semgrep, bandit, eslint]\n  script:\n    - case $SCANNER in\n        semgrep) semgrep scan --config=auto --sarif -o sast-$SCANNER.sarif . ;;\n        bandit) bandit -r src/ -f sarif -o sast-bandit.sarif ;;\n        eslint) npx eslint --format @microsoft/sarif -o sast-eslint.sarif src/ ;;\n      esac\n  artifacts:\n    reports:\n      sast: sast-*.sarif', desc: 'GitLab SAST' },
                                { code: '# GitHub Actions\njobs:\n  sast:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - name: Semgrep\n        uses: returntocorp/semgrep-action@v1\n      - uses: github/codeql-action/upload-sarif@v2\n        with:\n          sarif_file: semgrep.sarif', desc: 'GitHub SAST' }
                            ],
                            tips: ['Parallelisez les scanners pour gagner du temps'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Etape 3: Test',
                        desc: 'SCA, container scan',
                        details: {
                            explanation: 'Analyse des dependances et des images conteneur.',
                            syntax: 'trivy fs, trivy image',
                            options: [],
                            examples: [
                                { code: '# Stage Test Security\ntest-security:\n  stage: test\n  script:\n    # SCA\n    - trivy fs --severity HIGH,CRITICAL --exit-code 1 .\n    \n    # Build image\n    - docker build -t $IMAGE .\n    \n    # Container scan\n    - trivy image --severity HIGH,CRITICAL --exit-code 1 $IMAGE\n    \n    # SBOM\n    - trivy image --format cyclonedx -o sbom.json $IMAGE\n  artifacts:\n    paths:\n      - sbom.json', desc: 'Security tests' },
                                { code: '# GitHub Actions\njobs:\n  container-security:\n    steps:\n      - name: Build\n        run: docker build -t $IMAGE .\n      \n      - name: Trivy scan\n        uses: aquasecurity/trivy-action@master\n        with:\n          image-ref: ${{ env.IMAGE }}\n          exit-code: 1\n          severity: CRITICAL', desc: 'GHA container' }
                            ],
                            tips: ['Generez un SBOM a chaque build'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Etape 4: Deploy',
                        desc: 'IaC scan, admission',
                        details: {
                            explanation: 'Validation de l\'infrastructure et controle d\'admission.',
                            syntax: 'checkov, kyverno/gatekeeper',
                            options: [],
                            examples: [
                                { code: '# Pre-deploy checks\ndeploy:\n  stage: deploy\n  script:\n    # IaC scan\n    - checkov -d terraform/ --soft-fail\n    - checkov -d k8s/ --framework kubernetes\n    \n    # Sign image\n    - cosign sign --key $COSIGN_KEY $IMAGE\n    \n    # Deploy\n    - kubectl apply -f k8s/\n    \n    # Verify\n    - kubectl rollout status deployment/myapp', desc: 'Deploy stage' },
                                { code: '# Kyverno admission (cluster)\napiVersion: kyverno.io/v1\nkind: ClusterPolicy\nmetadata:\n  name: verify-image\nspec:\n  validationFailureAction: enforce\n  rules:\n    - name: verify-signature\n      match:\n        resources:\n          kinds: ["Pod"]\n      verifyImages:\n        - imageReferences: ["myregistry/*"]\n          attestors:\n            - entries:\n                - keys:\n                    publicKeys: |-\n                      -----BEGIN PUBLIC KEY-----\n                      ...', desc: 'Admission control' }
                            ],
                            tips: ['Utilisez admission controllers pour bloquer les images non signees'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Etape 5: Runtime',
                        desc: 'monitoring, DAST',
                        details: {
                            explanation: 'Surveillance continue et tests dynamiques en production.',
                            syntax: 'Falco, ZAP scheduled, monitoring',
                            options: [],
                            examples: [
                                { code: '# Scheduled DAST\nname: Weekly DAST\non:\n  schedule:\n    - cron: "0 3 * * 1"\njobs:\n  dast:\n    runs-on: ubuntu-latest\n    steps:\n      - name: ZAP Full Scan\n        uses: zaproxy/action-full-scan@v0.7.0\n        with:\n          target: https://staging.example.com\n      - name: Upload results\n        run: |\n          curl -X POST "$DEFECTDOJO_URL/api/v2/import-scan/" \\\n            -F "file=@zap-report.json" \\\n            -F "scan_type=ZAP Scan"', desc: 'Scheduled DAST' },
                                { code: '# Falco runtime monitoring\n# Deploye comme DaemonSet dans K8s\nhelm install falco falcosecurity/falco \\\n  --set falcosidekick.enabled=true \\\n  --set falcosidekick.config.slack.webhookurl=$SLACK_WEBHOOK', desc: 'Runtime monitoring' },
                                { code: '# Pipeline complet resume\n# 1. Pre-commit: gitleaks, semgrep\n# 2. Build: SAST (semgrep, bandit)\n# 3. Test: SCA (trivy fs), Container scan\n# 4. Deploy: IaC scan, Image signing, Admission\n# 5. Runtime: Falco, Scheduled DAST, Monitoring', desc: 'Resume pipeline' }
                            ],
                            tips: ['Le monitoring runtime detecte les zero-days et comportements anormaux'],
                            warnings: ['DAST en staging, pas directement en prod']
                        }
                    }
                ]
            }
        ];
    </script>
    <script src="../js/cheatsheet.js"></script>
</body>
</html>
