<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Aide-mémoire Django REST Framework : workflows pratiques pour créer des APIs RESTful.">
    <title>Django REST Framework - IT Cheatsheets</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body class="dark-theme text-slate-200">

    <header class="bg-slate-900/50 border-b border-white/5 py-8 px-4 relative overflow-hidden header-glow">
        <div class="max-w-4xl mx-auto relative z-10">
            <div class="flex items-center justify-between mb-4">
                <a href="../index.html" class="nav-back inline-flex items-center text-slate-400 hover:text-sky-400 transition">
                    <i class="fas fa-arrow-left mr-2"></i>Retour
                </a>
                <a href="../index.html" class="inline-flex items-center text-slate-400 hover:text-sky-400 transition">
                    <i class="fas fa-home mr-2"></i>Accueil
                </a>
            </div>
            <div class="text-center">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-xl bg-red-500/20 mb-4 icon-glow">
                    <i class="fas fa-plug text-3xl text-red-400"></i>
                </div>
                <h1 class="text-3xl font-bold mb-2 gradient-text">Django REST Framework</h1>
                <p class="text-slate-400">Workflows pratiques pour créer des APIs RESTful</p>
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-4 relative z-10">
        <div class="mb-8 relative">
            <input type="text" id="searchInput" placeholder="Rechercher un workflow..."
                   class="search-dark w-full p-4 pl-12 rounded-lg outline-none transition">
            <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-500"></i>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="categoriesGrid"></div>
    </main>

    <div id="detailModal" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50 p-4 modal-overlay" onclick="closeModal(event)">
        <div class="modal-content-dark rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl modal-content" onclick="event.stopPropagation()">
            <div id="modalContent"></div>
        </div>
    </div>

    <footer class="border-t border-white/5 text-center text-slate-500 py-8 text-sm relative z-10">
        <p>© 2026 - Dr FENOHASINA Toto Jean Felicien</p>
    </footer>

    <script>
        const cheatsheetData = [
            {
                id: 'start-api',
                title: 'Démarrer avec DRF',
                icon: 'fa-cog',
                color: 'border-l-4 border-red-500',
                commands: [
                    {
                        cmd: 'Installer et configurer DRF',
                        desc: 'pip install et INSTALLED_APPS',
                        details: {
                            explanation: 'Installe Django REST Framework et configure le projet pour l\'utiliser.',
                            syntax: 'pip install djangorestframework',
                            options: [
                                { flag: 'djangorestframework', desc: 'Package principal' },
                                { flag: 'django-filter', desc: 'Pour le filtrage avancé' },
                                { flag: 'djangorestframework-simplejwt', desc: 'Pour JWT' }
                            ],
                            examples: [
                                { code: '# Installation\npip install djangorestframework\npip install django-filter\npip install djangorestframework-simplejwt', desc: 'Packages recommandés' },
                                { code: '# settings.py\nINSTALLED_APPS = [\n    ...\n    "rest_framework",\n    "django_filters",\n]', desc: 'Configuration INSTALLED_APPS' }
                            ],
                            tips: ['Installez aussi django-cors-headers pour les APIs cross-origin'],
                            warnings: ['N\'oubliez pas d\'ajouter rest_framework à INSTALLED_APPS']
                        }
                    },
                    {
                        cmd: 'Configurer les paramètres globaux',
                        desc: 'REST_FRAMEWORK settings',
                        details: {
                            explanation: 'Configure les paramètres par défaut de DRF : pagination, authentification, permissions.',
                            syntax: 'REST_FRAMEWORK = { ... }',
                            options: [
                                { flag: 'DEFAULT_AUTHENTICATION_CLASSES', desc: 'Classes d\'authentification' },
                                { flag: 'DEFAULT_PERMISSION_CLASSES', desc: 'Permissions par défaut' },
                                { flag: 'DEFAULT_PAGINATION_CLASS', desc: 'Classe de pagination' },
                                { flag: 'PAGE_SIZE', desc: 'Taille des pages' }
                            ],
                            examples: [
                                { code: '# settings.py\nREST_FRAMEWORK = {\n    "DEFAULT_AUTHENTICATION_CLASSES": [\n        "rest_framework.authentication.SessionAuthentication",\n        "rest_framework_simplejwt.authentication.JWTAuthentication",\n    ],\n    "DEFAULT_PERMISSION_CLASSES": [\n        "rest_framework.permissions.IsAuthenticatedOrReadOnly",\n    ],\n    "DEFAULT_PAGINATION_CLASS": "rest_framework.pagination.PageNumberPagination",\n    "PAGE_SIZE": 10,\n    "DEFAULT_FILTER_BACKENDS": [\n        "django_filters.rest_framework.DjangoFilterBackend",\n        "rest_framework.filters.SearchFilter",\n        "rest_framework.filters.OrderingFilter",\n    ],\n}', desc: 'Configuration complète' }
                            ],
                            tips: ['Ces paramètres peuvent être surchargés par vue'],
                            warnings: ['Évitez AllowAny en production sauf cas spécifique']
                        }
                    },
                    {
                        cmd: 'Ajouter l\'interface navigable',
                        desc: 'Browsable API pour le développement',
                        details: {
                            explanation: 'Active l\'interface web interactive de DRF pour tester l\'API.',
                            syntax: 'path("api-auth/", include("rest_framework.urls"))',
                            options: [
                                { flag: 'BrowsableAPIRenderer', desc: 'Rendu HTML interactif' },
                                { flag: 'JSONRenderer', desc: 'Rendu JSON uniquement' }
                            ],
                            examples: [
                                { code: '# urls.py\nfrom django.urls import path, include\n\nurlpatterns = [\n    ...\n    path("api-auth/", include("rest_framework.urls")),\n]', desc: 'Activer le login/logout' },
                                { code: '# Désactiver en production\nREST_FRAMEWORK = {\n    "DEFAULT_RENDERER_CLASSES": [\n        "rest_framework.renderers.JSONRenderer",\n    ] if not DEBUG else [\n        "rest_framework.renderers.JSONRenderer",\n        "rest_framework.renderers.BrowsableAPIRenderer",\n    ]\n}', desc: 'Conditionnel selon DEBUG' }
                            ],
                            tips: ['L\'interface navigable est excellente pour le debug'],
                            warnings: ['Désactivez-la en production pour de meilleures performances']
                        }
                    },
                    {
                        cmd: 'Versionner mon API',
                        desc: 'URLPathVersioning, NamespaceVersioning',
                        details: {
                            explanation: 'Configure le versioning de l\'API pour gérer les évolutions.',
                            syntax: 'DEFAULT_VERSIONING_CLASS',
                            options: [
                                { flag: 'URLPathVersioning', desc: '/api/v1/... (recommandé)' },
                                { flag: 'NamespaceVersioning', desc: 'Via les namespaces d\'URL' },
                                { flag: 'QueryParameterVersioning', desc: '?version=1.0' },
                                { flag: 'AcceptHeaderVersioning', desc: 'Via le header Accept' }
                            ],
                            examples: [
                                { code: '# settings.py\nREST_FRAMEWORK = {\n    "DEFAULT_VERSIONING_CLASS": "rest_framework.versioning.URLPathVersioning",\n    "DEFAULT_VERSION": "v1",\n    "ALLOWED_VERSIONS": ["v1", "v2"],\n}', desc: 'Configuration URLPath' },
                                { code: '# urls.py\nurlpatterns = [\n    path("api/v1/", include("api.urls", namespace="v1")),\n    path("api/v2/", include("api.urls_v2", namespace="v2")),\n]', desc: 'URLs versionnées' },
                                { code: '# Dans une vue\ndef get(self, request):\n    if request.version == "v2":\n        # Nouvelle logique\n        pass', desc: 'Accéder à la version' }
                            ],
                            tips: ['Préférez URLPathVersioning pour sa clarté'],
                            warnings: ['Planifiez le versioning dès le début du projet']
                        }
                    }
                ]
            },
            {
                id: 'serialize-data',
                title: 'Sérialiser mes Données',
                icon: 'fa-exchange-alt',
                color: 'border-l-4 border-blue-500',
                commands: [
                    {
                        cmd: 'Créer un serializer pour mon modèle',
                        desc: 'ModelSerializer avec fields',
                        details: {
                            explanation: 'Crée un serializer qui convertit les modèles Django en JSON et vice-versa.',
                            syntax: 'class MySerializer(serializers.ModelSerializer): ...',
                            options: [
                                { flag: 'fields', desc: 'Liste des champs à inclure' },
                                { flag: 'exclude', desc: 'Champs à exclure' },
                                { flag: 'read_only_fields', desc: 'Champs en lecture seule' },
                                { flag: 'extra_kwargs', desc: 'Options supplémentaires par champ' }
                            ],
                            examples: [
                                { code: 'from rest_framework import serializers\nfrom .models import Post\n\nclass PostSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = Post\n        fields = ["id", "title", "content", "author", "created"]\n        read_only_fields = ["id", "created"]', desc: 'Serializer basique' },
                                { code: 'class PostSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = Post\n        fields = "__all__"\n        extra_kwargs = {\n            "content": {"required": True, "min_length": 10},\n            "author": {"read_only": True}\n        }', desc: 'Avec extra_kwargs' }
                            ],
                            tips: ['Préférez fields explicites plutôt que __all__'],
                            warnings: ['N\'exposez jamais de données sensibles (passwords, tokens)']
                        }
                    },
                    {
                        cmd: 'Valider et sauvegarder les données',
                        desc: 'is_valid() et save()',
                        details: {
                            explanation: 'Valide les données entrantes et crée/met à jour les objets.',
                            syntax: 'serializer.is_valid() / serializer.save()',
                            options: [
                                { flag: 'is_valid()', desc: 'Valide les données' },
                                { flag: 'raise_exception=True', desc: 'Lève une exception si invalide' },
                                { flag: 'save()', desc: 'Crée ou met à jour l\'objet' },
                                { flag: 'validated_data', desc: 'Données validées' }
                            ],
                            examples: [
                                { code: '# Dans une vue\nserializer = PostSerializer(data=request.data)\nif serializer.is_valid():\n    serializer.save(author=request.user)\n    return Response(serializer.data, status=201)\nreturn Response(serializer.errors, status=400)', desc: 'Validation manuelle' },
                                { code: '# Avec raise_exception\nserializer = PostSerializer(data=request.data)\nserializer.is_valid(raise_exception=True)\nserializer.save(author=request.user)\nreturn Response(serializer.data, status=201)', desc: 'Avec exception automatique' },
                                { code: '# Mise à jour\npost = Post.objects.get(pk=pk)\nserializer = PostSerializer(post, data=request.data, partial=True)\nserializer.is_valid(raise_exception=True)\nserializer.save()', desc: 'Mise à jour partielle' }
                            ],
                            tips: ['Utilisez raise_exception=True pour simplifier le code'],
                            warnings: ['partial=True permet les mises à jour partielles (PATCH)']
                        }
                    },
                    {
                        cmd: 'Ajouter des champs calculés',
                        desc: 'SerializerMethodField',
                        details: {
                            explanation: 'Ajoute des champs en lecture seule dont la valeur est calculée.',
                            syntax: 'field = serializers.SerializerMethodField()',
                            options: [
                                { flag: 'SerializerMethodField', desc: 'Champ calculé en lecture' },
                                { flag: 'get_<field_name>', desc: 'Méthode qui calcule la valeur' }
                            ],
                            examples: [
                                { code: 'class PostSerializer(serializers.ModelSerializer):\n    word_count = serializers.SerializerMethodField()\n    author_name = serializers.SerializerMethodField()\n    \n    class Meta:\n        model = Post\n        fields = ["id", "title", "content", "word_count", "author_name"]\n    \n    def get_word_count(self, obj):\n        return len(obj.content.split())\n    \n    def get_author_name(self, obj):\n        return obj.author.get_full_name() or obj.author.username', desc: 'Champs calculés' },
                                { code: '# Accéder au contexte\ndef get_is_owner(self, obj):\n    request = self.context.get("request")\n    return request and obj.author == request.user', desc: 'Avec contexte' }
                            ],
                            tips: ['Le contexte contient request, view, format'],
                            warnings: ['Ces champs sont en lecture seule uniquement']
                        }
                    },
                    {
                        cmd: 'Inclure des relations imbriquées',
                        desc: 'Nested Serializers',
                        details: {
                            explanation: 'Inclut les données des objets liés dans la réponse.',
                            syntax: 'related = RelatedSerializer()',
                            options: [
                                { flag: 'many=True', desc: 'Pour les relations multiples' },
                                { flag: 'read_only=True', desc: 'Lecture seule' },
                                { flag: 'depth', desc: 'Profondeur automatique' }
                            ],
                            examples: [
                                { code: 'class CommentSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = Comment\n        fields = ["id", "content", "created"]\n\nclass PostSerializer(serializers.ModelSerializer):\n    comments = CommentSerializer(many=True, read_only=True)\n    author = UserSerializer(read_only=True)\n    \n    class Meta:\n        model = Post\n        fields = ["id", "title", "content", "author", "comments"]', desc: 'Serializers imbriqués' },
                                { code: '# Alternative avec depth\nclass PostSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = Post\n        fields = "__all__"\n        depth = 1  # Inclut 1 niveau de relations', desc: 'Avec depth (simple)' }
                            ],
                            tips: ['depth est pratique mais moins contrôlable'],
                            warnings: ['Attention aux performances avec beaucoup de données imbriquées']
                        }
                    },
                    {
                        cmd: 'Personnaliser l\'entrée/sortie',
                        desc: 'to_representation et to_internal_value',
                        details: {
                            explanation: 'Personnalise la conversion entre les données internes et externes.',
                            syntax: 'def to_representation(self, instance): ...',
                            options: [
                                { flag: 'to_representation', desc: 'Modèle → JSON (lecture)' },
                                { flag: 'to_internal_value', desc: 'JSON → données (écriture)' }
                            ],
                            examples: [
                                { code: 'class PostSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = Post\n        fields = ["id", "title", "content", "status"]\n    \n    def to_representation(self, instance):\n        data = super().to_representation(instance)\n        # Ajouter des infos supplémentaires\n        data["status_display"] = instance.get_status_display()\n        data["url"] = instance.get_absolute_url()\n        return data', desc: 'Personnaliser la sortie' },
                                { code: 'def to_internal_value(self, data):\n    # Transformer les données entrantes\n    if "title" in data:\n        data["title"] = data["title"].strip().title()\n    return super().to_internal_value(data)', desc: 'Transformer l\'entrée' }
                            ],
                            tips: ['Utile pour ajouter des URLs, formats de date, etc.'],
                            warnings: ['N\'oubliez pas d\'appeler super() pour garder le comportement de base']
                        }
                    }
                ]
            },
            {
                id: 'create-endpoints',
                title: 'Créer mes Endpoints',
                icon: 'fa-route',
                color: 'border-l-4 border-green-500',
                commands: [
                    {
                        cmd: 'Créer un CRUD complet',
                        desc: 'ModelViewSet pour toutes les opérations',
                        details: {
                            explanation: 'Crée automatiquement les endpoints list, create, retrieve, update, destroy.',
                            syntax: 'class MyViewSet(viewsets.ModelViewSet): ...',
                            options: [
                                { flag: 'queryset', desc: 'QuerySet de base' },
                                { flag: 'serializer_class', desc: 'Serializer à utiliser' },
                                { flag: 'permission_classes', desc: 'Permissions requises' },
                                { flag: 'filterset_fields', desc: 'Champs filtrables' }
                            ],
                            examples: [
                                { code: 'from rest_framework import viewsets\nfrom .models import Post\nfrom .serializers import PostSerializer\n\nclass PostViewSet(viewsets.ModelViewSet):\n    queryset = Post.objects.all()\n    serializer_class = PostSerializer\n    permission_classes = [IsAuthenticatedOrReadOnly]\n    filterset_fields = ["status", "author"]\n    search_fields = ["title", "content"]\n    ordering_fields = ["created", "title"]', desc: 'ViewSet complet' },
                                { code: '# Généré automatiquement :\n# GET /posts/ → list\n# POST /posts/ → create\n# GET /posts/{id}/ → retrieve\n# PUT /posts/{id}/ → update\n# PATCH /posts/{id}/ → partial_update\n# DELETE /posts/{id}/ → destroy', desc: 'Endpoints générés' }
                            ],
                            tips: ['ModelViewSet = ReadOnlyModelViewSet + CreateModelMixin + UpdateModelMixin + DestroyModelMixin'],
                            warnings: ['Pensez aux permissions pour chaque action']
                        }
                    },
                    {
                        cmd: 'Créer une vue fonction',
                        desc: '@api_view decorator',
                        details: {
                            explanation: 'Crée une vue fonction avec les fonctionnalités DRF.',
                            syntax: '@api_view(["GET", "POST"])',
                            options: [
                                { flag: 'GET', desc: 'Lecture' },
                                { flag: 'POST', desc: 'Création' },
                                { flag: 'PUT/PATCH', desc: 'Mise à jour' },
                                { flag: 'DELETE', desc: 'Suppression' }
                            ],
                            examples: [
                                { code: 'from rest_framework.decorators import api_view, permission_classes\nfrom rest_framework.response import Response\nfrom rest_framework.permissions import IsAuthenticated\n\n@api_view(["GET", "POST"])\n@permission_classes([IsAuthenticated])\ndef post_list(request):\n    if request.method == "GET":\n        posts = Post.objects.all()\n        serializer = PostSerializer(posts, many=True)\n        return Response(serializer.data)\n    \n    elif request.method == "POST":\n        serializer = PostSerializer(data=request.data)\n        serializer.is_valid(raise_exception=True)\n        serializer.save(author=request.user)\n        return Response(serializer.data, status=201)', desc: 'Vue fonction liste/create' },
                                { code: '@api_view(["GET", "PUT", "DELETE"])\ndef post_detail(request, pk):\n    post = get_object_or_404(Post, pk=pk)\n    \n    if request.method == "GET":\n        serializer = PostSerializer(post)\n        return Response(serializer.data)\n    \n    elif request.method == "PUT":\n        serializer = PostSerializer(post, data=request.data)\n        serializer.is_valid(raise_exception=True)\n        serializer.save()\n        return Response(serializer.data)\n    \n    elif request.method == "DELETE":\n        post.delete()\n        return Response(status=204)', desc: 'Vue fonction détail' }
                            ],
                            tips: ['Plus de contrôle mais plus de code que les ViewSets'],
                            warnings: ['N\'oubliez pas les permissions']
                        }
                    },
                    {
                        cmd: 'Créer une vue classe',
                        desc: 'APIView pour contrôle total',
                        details: {
                            explanation: 'Crée une vue basée sur une classe avec contrôle total.',
                            syntax: 'class MyView(APIView): ...',
                            options: [
                                { flag: 'get()', desc: 'Méthode GET' },
                                { flag: 'post()', desc: 'Méthode POST' },
                                { flag: 'put()', desc: 'Méthode PUT' },
                                { flag: 'delete()', desc: 'Méthode DELETE' }
                            ],
                            examples: [
                                { code: 'from rest_framework.views import APIView\nfrom rest_framework.response import Response\nfrom rest_framework import status\n\nclass PostListView(APIView):\n    permission_classes = [IsAuthenticatedOrReadOnly]\n    \n    def get(self, request):\n        posts = Post.objects.all()\n        serializer = PostSerializer(posts, many=True)\n        return Response(serializer.data)\n    \n    def post(self, request):\n        serializer = PostSerializer(data=request.data)\n        serializer.is_valid(raise_exception=True)\n        serializer.save(author=request.user)\n        return Response(serializer.data, status=status.HTTP_201_CREATED)', desc: 'APIView liste' },
                                { code: 'class PostDetailView(APIView):\n    def get_object(self, pk):\n        return get_object_or_404(Post, pk=pk)\n    \n    def get(self, request, pk):\n        post = self.get_object(pk)\n        serializer = PostSerializer(post)\n        return Response(serializer.data)\n    \n    def put(self, request, pk):\n        post = self.get_object(pk)\n        serializer = PostSerializer(post, data=request.data)\n        serializer.is_valid(raise_exception=True)\n        serializer.save()\n        return Response(serializer.data)\n    \n    def delete(self, request, pk):\n        post = self.get_object(pk)\n        post.delete()\n        return Response(status=status.HTTP_204_NO_CONTENT)', desc: 'APIView détail' }
                            ],
                            tips: ['Utilisez status.HTTP_XXX pour la clarté'],
                            warnings: ['Plus verbeux que les ViewSets mais plus flexible']
                        }
                    },
                    {
                        cmd: 'Ajouter une action personnalisée',
                        desc: '@action decorator pour ViewSet',
                        details: {
                            explanation: 'Ajoute des endpoints personnalisés à un ViewSet.',
                            syntax: '@action(detail=True/False, methods=["post"])',
                            options: [
                                { flag: 'detail=True', desc: 'Action sur un objet (/posts/{id}/action/)' },
                                { flag: 'detail=False', desc: 'Action sur la collection (/posts/action/)' },
                                { flag: 'methods', desc: 'Méthodes HTTP acceptées' },
                                { flag: 'url_path', desc: 'Personnaliser l\'URL' }
                            ],
                            examples: [
                                { code: 'from rest_framework.decorators import action\nfrom rest_framework.response import Response\n\nclass PostViewSet(viewsets.ModelViewSet):\n    queryset = Post.objects.all()\n    serializer_class = PostSerializer\n    \n    @action(detail=True, methods=["post"])\n    def publish(self, request, pk=None):\n        """POST /posts/{id}/publish/"""\n        post = self.get_object()\n        post.status = "published"\n        post.save()\n        return Response({"status": "published"})\n    \n    @action(detail=True, methods=["post"])\n    def like(self, request, pk=None):\n        """POST /posts/{id}/like/"""\n        post = self.get_object()\n        post.likes.add(request.user)\n        return Response({"likes": post.likes.count()})', desc: 'Actions sur un objet' },
                                { code: '@action(detail=False, methods=["get"])\ndef recent(self, request):\n    """GET /posts/recent/"""\n    recent_posts = Post.objects.filter(\n        status="published"\n    ).order_by("-created")[:5]\n    serializer = self.get_serializer(recent_posts, many=True)\n    return Response(serializer.data)\n\n@action(detail=False, methods=["get"], url_path="my-posts")\ndef my_posts(self, request):\n    """GET /posts/my-posts/"""\n    posts = Post.objects.filter(author=request.user)\n    serializer = self.get_serializer(posts, many=True)\n    return Response(serializer.data)', desc: 'Actions sur la collection' }
                            ],
                            tips: ['url_path permet de personnaliser l\'URL (- au lieu de _)'],
                            warnings: ['Définissez permission_classes si différentes du ViewSet']
                        }
                    },
                    {
                        cmd: 'Configurer le routage automatique',
                        desc: 'DefaultRouter et SimpleRouter',
                        details: {
                            explanation: 'Configure automatiquement les URLs pour les ViewSets.',
                            syntax: 'router.register("prefix", ViewSet)',
                            options: [
                                { flag: 'DefaultRouter', desc: 'Avec page d\'accueil API' },
                                { flag: 'SimpleRouter', desc: 'Sans page d\'accueil' },
                                { flag: 'basename', desc: 'Nom de base pour les URLs' }
                            ],
                            examples: [
                                { code: '# api/urls.py\nfrom django.urls import path, include\nfrom rest_framework.routers import DefaultRouter\nfrom .views import PostViewSet, CommentViewSet\n\nrouter = DefaultRouter()\nrouter.register("posts", PostViewSet, basename="post")\nrouter.register("comments", CommentViewSet, basename="comment")\n\nurlpatterns = [\n    path("", include(router.urls)),\n]', desc: 'Configuration router' },
                                { code: '# URLs générées :\n# GET/POST /posts/\n# GET/PUT/PATCH/DELETE /posts/{id}/\n# GET/POST /posts/{id}/publish/ (action)\n# GET /posts/recent/ (action)\n\n# urls.py principal\nurlpatterns = [\n    path("admin/", admin.site.urls),\n    path("api/", include("api.urls")),\n]', desc: 'URLs générées' }
                            ],
                            tips: ['DefaultRouter ajoute une page d\'accueil listant les endpoints'],
                            warnings: ['basename est obligatoire si queryset n\'est pas défini']
                        }
                    }
                ]
            },
            {
                id: 'secure-api',
                title: 'Sécuriser mon API',
                icon: 'fa-lock',
                color: 'border-l-4 border-yellow-500',
                commands: [
                    {
                        cmd: 'Requérir l\'authentification',
                        desc: 'IsAuthenticated permission',
                        details: {
                            explanation: 'Restreint l\'accès aux utilisateurs authentifiés.',
                            syntax: 'permission_classes = [IsAuthenticated]',
                            options: [
                                { flag: 'AllowAny', desc: 'Accès libre' },
                                { flag: 'IsAuthenticated', desc: 'Utilisateur connecté requis' },
                                { flag: 'IsAdminUser', desc: 'Staff requis' },
                                { flag: 'IsAuthenticatedOrReadOnly', desc: 'Connecté pour écrire' }
                            ],
                            examples: [
                                { code: 'from rest_framework.permissions import IsAuthenticated, IsAuthenticatedOrReadOnly\n\nclass PostViewSet(viewsets.ModelViewSet):\n    queryset = Post.objects.all()\n    serializer_class = PostSerializer\n    permission_classes = [IsAuthenticatedOrReadOnly]', desc: 'Permission sur ViewSet' },
                                { code: '# Permissions par action\nclass PostViewSet(viewsets.ModelViewSet):\n    queryset = Post.objects.all()\n    serializer_class = PostSerializer\n    \n    def get_permissions(self):\n        if self.action in ["create", "update", "destroy"]:\n            return [IsAuthenticated()]\n        return [AllowAny()]', desc: 'Permissions conditionnelles' }
                            ],
                            tips: ['Utilisez IsAuthenticatedOrReadOnly pour les APIs publiques en lecture'],
                            warnings: ['N\'utilisez jamais AllowAny pour des données sensibles']
                        }
                    },
                    {
                        cmd: 'Créer une permission personnalisée',
                        desc: 'BasePermission pour règles métier',
                        details: {
                            explanation: 'Crée des permissions personnalisées pour des règles métier.',
                            syntax: 'class MyPermission(BasePermission): ...',
                            options: [
                                { flag: 'has_permission', desc: 'Permission sur la vue' },
                                { flag: 'has_object_permission', desc: 'Permission sur l\'objet' }
                            ],
                            examples: [
                                { code: 'from rest_framework.permissions import BasePermission\n\nclass IsOwnerOrReadOnly(BasePermission):\n    """\n    Permet la lecture à tous, l\'écriture uniquement au propriétaire.\n    """\n    def has_object_permission(self, request, view, obj):\n        # Lecture autorisée pour tous\n        if request.method in ["GET", "HEAD", "OPTIONS"]:\n            return True\n        # Écriture uniquement pour le propriétaire\n        return obj.author == request.user', desc: 'Permission propriétaire' },
                                { code: 'class IsPremiumUser(BasePermission):\n    """\n    Autorise uniquement les utilisateurs premium.\n    """\n    message = "Abonnement premium requis."\n    \n    def has_permission(self, request, view):\n        return (\n            request.user.is_authenticated and\n            request.user.profile.is_premium\n        )', desc: 'Permission premium' },
                                { code: '# Utilisation\nclass PostViewSet(viewsets.ModelViewSet):\n    permission_classes = [IsAuthenticated, IsOwnerOrReadOnly]', desc: 'Application' }
                            ],
                            tips: ['Les permissions sont combinées avec AND par défaut'],
                            warnings: ['Définissez message pour des erreurs explicites']
                        }
                    },
                    {
                        cmd: 'Utiliser l\'authentification par token',
                        desc: 'TokenAuthentication simple',
                        details: {
                            explanation: 'Authentifie les requêtes via un token dans le header.',
                            syntax: 'Authorization: Token <token>',
                            options: [
                                { flag: 'TokenAuthentication', desc: 'Authentification par token' },
                                { flag: 'obtain_auth_token', desc: 'Vue pour obtenir un token' }
                            ],
                            examples: [
                                { code: '# settings.py\nINSTALLED_APPS = [\n    ...\n    "rest_framework.authtoken",\n]\n\nREST_FRAMEWORK = {\n    "DEFAULT_AUTHENTICATION_CLASSES": [\n        "rest_framework.authentication.TokenAuthentication",\n    ],\n}\n\n# Créer les tables\n# python manage.py migrate', desc: 'Configuration' },
                                { code: '# urls.py\nfrom rest_framework.authtoken.views import obtain_auth_token\n\nurlpatterns = [\n    path("api-token-auth/", obtain_auth_token),\n]\n\n# Requête pour obtenir un token :\n# POST /api-token-auth/\n# {"username": "user", "password": "pass"}\n# Réponse : {"token": "9944b09199c62bcf9418ad846dd0e4bbdfc6ee4b"}', desc: 'Obtenir un token' },
                                { code: '# Utilisation du token\n# Header: Authorization: Token 9944b09199c62bcf9418ad846dd0e4bbdfc6ee4b\n\n# Avec curl :\ncurl -H "Authorization: Token 9944b..." http://api/posts/', desc: 'Utiliser le token' }
                            ],
                            tips: ['Créez un token par utilisateur avec Token.objects.create(user=user)'],
                            warnings: ['Le token ne expire pas par défaut, considérez JWT']
                        }
                    },
                    {
                        cmd: 'Utiliser JWT',
                        desc: 'SimpleJWT pour tokens avec expiration',
                        details: {
                            explanation: 'Utilise JSON Web Tokens avec refresh et expiration.',
                            syntax: 'Authorization: Bearer <access_token>',
                            options: [
                                { flag: 'ACCESS_TOKEN_LIFETIME', desc: 'Durée de vie du token d\'accès' },
                                { flag: 'REFRESH_TOKEN_LIFETIME', desc: 'Durée de vie du refresh token' },
                                { flag: 'ROTATE_REFRESH_TOKENS', desc: 'Nouveau refresh à chaque utilisation' }
                            ],
                            examples: [
                                { code: '# Installation\npip install djangorestframework-simplejwt\n\n# settings.py\nfrom datetime import timedelta\n\nREST_FRAMEWORK = {\n    "DEFAULT_AUTHENTICATION_CLASSES": [\n        "rest_framework_simplejwt.authentication.JWTAuthentication",\n    ],\n}\n\nSIMPLE_JWT = {\n    "ACCESS_TOKEN_LIFETIME": timedelta(minutes=15),\n    "REFRESH_TOKEN_LIFETIME": timedelta(days=7),\n    "ROTATE_REFRESH_TOKENS": True,\n}', desc: 'Configuration JWT' },
                                { code: '# urls.py\nfrom rest_framework_simplejwt.views import (\n    TokenObtainPairView,\n    TokenRefreshView,\n    TokenVerifyView,\n)\n\nurlpatterns = [\n    path("api/token/", TokenObtainPairView.as_view()),\n    path("api/token/refresh/", TokenRefreshView.as_view()),\n    path("api/token/verify/", TokenVerifyView.as_view()),\n]', desc: 'URLs JWT' },
                                { code: '# Obtenir les tokens\n# POST /api/token/ {"username": "...", "password": "..."}\n# Réponse : {"access": "...", "refresh": "..."}\n\n# Utiliser\n# Header: Authorization: Bearer <access_token>\n\n# Rafraîchir\n# POST /api/token/refresh/ {"refresh": "..."}\n# Réponse : {"access": "..."}', desc: 'Utilisation JWT' }
                            ],
                            tips: ['Stockez le refresh token de manière sécurisée (httpOnly cookie)'],
                            warnings: ['Les tokens JWT ne peuvent pas être invalidés côté serveur']
                        }
                    },
                    {
                        cmd: 'Limiter l\'accès au propriétaire',
                        desc: 'IsOwnerOrReadOnly custom',
                        details: {
                            explanation: 'Restreint les modifications au propriétaire de l\'objet.',
                            syntax: 'has_object_permission(request, view, obj)',
                            options: [
                                { flag: 'SAFE_METHODS', desc: 'GET, HEAD, OPTIONS' },
                                { flag: 'obj.author', desc: 'Champ propriétaire' }
                            ],
                            examples: [
                                { code: '# permissions.py\nfrom rest_framework.permissions import BasePermission, SAFE_METHODS\n\nclass IsOwnerOrReadOnly(BasePermission):\n    def has_object_permission(self, request, view, obj):\n        if request.method in SAFE_METHODS:\n            return True\n        return obj.author == request.user\n\nclass IsOwner(BasePermission):\n    def has_object_permission(self, request, view, obj):\n        return obj.author == request.user', desc: 'Permissions propriétaire' },
                                { code: '# views.py\nclass PostViewSet(viewsets.ModelViewSet):\n    queryset = Post.objects.all()\n    serializer_class = PostSerializer\n    permission_classes = [IsAuthenticatedOrReadOnly, IsOwnerOrReadOnly]\n    \n    def perform_create(self, serializer):\n        serializer.save(author=self.request.user)', desc: 'Utilisation avec ViewSet' }
                            ],
                            tips: ['Combinez avec IsAuthenticatedOrReadOnly pour un accès public en lecture'],
                            warnings: ['N\'oubliez pas d\'assigner l\'auteur dans perform_create']
                        }
                    }
                ]
            },
            {
                id: 'filter-paginate',
                title: 'Filtrer et Paginer',
                icon: 'fa-filter',
                color: 'border-l-4 border-teal-500',
                commands: [
                    {
                        cmd: 'Ajouter une recherche textuelle',
                        desc: 'SearchFilter pour recherche full-text',
                        details: {
                            explanation: 'Ajoute une recherche textuelle sur des champs spécifiés.',
                            syntax: 'search_fields = ["field1", "field2"]',
                            options: [
                                { flag: '^field', desc: 'Commence par' },
                                { flag: '=field', desc: 'Correspondance exacte' },
                                { flag: '@field', desc: 'Recherche full-text (PostgreSQL)' },
                                { flag: '$field', desc: 'Regex' }
                            ],
                            examples: [
                                { code: 'from rest_framework.filters import SearchFilter\n\nclass PostViewSet(viewsets.ModelViewSet):\n    queryset = Post.objects.all()\n    serializer_class = PostSerializer\n    filter_backends = [SearchFilter]\n    search_fields = ["title", "content", "author__username"]\n    \n# Requête : GET /posts/?search=django\n# Recherche "django" dans title, content et username', desc: 'Configuration SearchFilter' },
                                { code: '# Préfixes\nsearch_fields = [\n    "^title",        # Commence par\n    "=status",       # Exactement égal\n    "content",       # Contient (défaut)\n    "author__email", # Relation\n]', desc: 'Préfixes de recherche' }
                            ],
                            tips: ['Utilisez __ pour les champs de relations'],
                            warnings: ['La recherche par défaut est case-insensitive']
                        }
                    },
                    {
                        cmd: 'Filtrer par champs',
                        desc: 'DjangoFilterBackend pour filtres précis',
                        details: {
                            explanation: 'Permet de filtrer les résultats par valeurs exactes de champs.',
                            syntax: 'filterset_fields = ["field1", "field2"]',
                            options: [
                                { flag: 'filterset_fields', desc: 'Liste simple de champs' },
                                { flag: 'filterset_class', desc: 'FilterSet personnalisé' }
                            ],
                            examples: [
                                { code: '# Installation : pip install django-filter\n\nfrom django_filters.rest_framework import DjangoFilterBackend\n\nclass PostViewSet(viewsets.ModelViewSet):\n    queryset = Post.objects.all()\n    serializer_class = PostSerializer\n    filter_backends = [DjangoFilterBackend]\n    filterset_fields = ["status", "author", "category"]\n\n# Requête : GET /posts/?status=published&author=1', desc: 'Filtres simples' },
                                { code: '# filters.py - FilterSet personnalisé\nimport django_filters\nfrom .models import Post\n\nclass PostFilter(django_filters.FilterSet):\n    title = django_filters.CharFilter(lookup_expr="icontains")\n    min_date = django_filters.DateFilter(field_name="created", lookup_expr="gte")\n    max_date = django_filters.DateFilter(field_name="created", lookup_expr="lte")\n    \n    class Meta:\n        model = Post\n        fields = ["status", "author", "title", "min_date", "max_date"]\n\n# views.py\nclass PostViewSet(viewsets.ModelViewSet):\n    filterset_class = PostFilter', desc: 'FilterSet personnalisé' }
                            ],
                            tips: ['Combinez plusieurs filter_backends pour recherche + filtrage'],
                            warnings: ['Ajoutez django_filters à INSTALLED_APPS']
                        }
                    },
                    {
                        cmd: 'Paginer les résultats',
                        desc: 'PageNumberPagination et LimitOffsetPagination',
                        details: {
                            explanation: 'Découpe les résultats en pages pour de meilleures performances.',
                            syntax: 'pagination_class = PageNumberPagination',
                            options: [
                                { flag: 'PageNumberPagination', desc: '?page=1 (défaut)' },
                                { flag: 'LimitOffsetPagination', desc: '?limit=10&offset=0' },
                                { flag: 'CursorPagination', desc: 'Pagination par curseur' }
                            ],
                            examples: [
                                { code: '# settings.py - Global\nREST_FRAMEWORK = {\n    "DEFAULT_PAGINATION_CLASS": "rest_framework.pagination.PageNumberPagination",\n    "PAGE_SIZE": 10,\n}\n\n# Réponse :\n# {\n#   "count": 100,\n#   "next": "http://.../posts/?page=2",\n#   "previous": null,\n#   "results": [...]\n# }', desc: 'Pagination globale' },
                                { code: '# pagination.py - Personnalisée\nfrom rest_framework.pagination import PageNumberPagination\n\nclass LargeResultsSetPagination(PageNumberPagination):\n    page_size = 100\n    page_size_query_param = "page_size"\n    max_page_size = 1000\n\n# views.py\nclass PostViewSet(viewsets.ModelViewSet):\n    pagination_class = LargeResultsSetPagination', desc: 'Pagination personnalisée' },
                                { code: '# LimitOffset\nfrom rest_framework.pagination import LimitOffsetPagination\n\nclass MyPagination(LimitOffsetPagination):\n    default_limit = 10\n    max_limit = 100\n\n# Requête : GET /posts/?limit=20&offset=40', desc: 'LimitOffset' }
                            ],
                            tips: ['CursorPagination est le plus performant pour de gros datasets'],
                            warnings: ['La pagination désactivée peut causer des problèmes de performance']
                        }
                    },
                    {
                        cmd: 'Trier les résultats',
                        desc: 'OrderingFilter pour tri dynamique',
                        details: {
                            explanation: 'Permet de trier les résultats par différents champs.',
                            syntax: 'ordering_fields = ["field1", "field2"]',
                            options: [
                                { flag: 'ordering_fields', desc: 'Champs triables' },
                                { flag: 'ordering', desc: 'Tri par défaut' },
                                { flag: '-field', desc: 'Tri descendant' }
                            ],
                            examples: [
                                { code: 'from rest_framework.filters import OrderingFilter\n\nclass PostViewSet(viewsets.ModelViewSet):\n    queryset = Post.objects.all()\n    serializer_class = PostSerializer\n    filter_backends = [OrderingFilter]\n    ordering_fields = ["created", "title", "author__username"]\n    ordering = ["-created"]  # Tri par défaut\n\n# Requêtes :\n# GET /posts/?ordering=title        # A-Z\n# GET /posts/?ordering=-title       # Z-A\n# GET /posts/?ordering=-created,title  # Multiple', desc: 'Configuration tri' },
                                { code: '# Combiner tous les filtres\nfrom rest_framework.filters import SearchFilter, OrderingFilter\nfrom django_filters.rest_framework import DjangoFilterBackend\n\nclass PostViewSet(viewsets.ModelViewSet):\n    filter_backends = [\n        DjangoFilterBackend,\n        SearchFilter,\n        OrderingFilter,\n    ]\n    filterset_fields = ["status", "category"]\n    search_fields = ["title", "content"]\n    ordering_fields = ["created", "title"]\n    ordering = ["-created"]', desc: 'Tous les filtres combinés' }
                            ],
                            tips: ['ordering par défaut assure un ordre cohérent pour la pagination'],
                            warnings: ['Utilisez ordering_fields pour limiter les champs triables']
                        }
                    }
                ]
            },
            {
                id: 'advanced-serializers',
                title: 'Serializers Avancés',
                icon: 'fa-layer-group',
                color: 'border-l-4 border-indigo-500',
                commands: [
                    {
                        cmd: 'Imbriquer des serializers en lecture',
                        desc: 'Nested serializers read-only',
                        details: {
                            explanation: 'Inclut les données des relations dans la réponse JSON.',
                            syntax: 'related = RelatedSerializer(read_only=True)',
                            options: [
                                { flag: 'many=True', desc: 'Pour les relations multiples' },
                                { flag: 'read_only=True', desc: 'Lecture seule' },
                                { flag: 'source', desc: 'Champ source différent' }
                            ],
                            examples: [
                                { code: 'class AuthorSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = User\n        fields = ["id", "username", "email"]\n\nclass CommentSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = Comment\n        fields = ["id", "content", "created"]\n\nclass PostSerializer(serializers.ModelSerializer):\n    author = AuthorSerializer(read_only=True)\n    comments = CommentSerializer(many=True, read_only=True)\n    \n    class Meta:\n        model = Post\n        fields = ["id", "title", "content", "author", "comments"]', desc: 'Serializers imbriqués' },
                                { code: '# Réponse JSON :\n{\n    "id": 1,\n    "title": "Mon article",\n    "content": "...",\n    "author": {\n        "id": 1,\n        "username": "john",\n        "email": "john@example.com"\n    },\n    "comments": [\n        {"id": 1, "content": "Super!", "created": "..."},\n        {"id": 2, "content": "Merci!", "created": "..."}\n    ]\n}', desc: 'Résultat' }
                            ],
                            tips: ['Optimisez avec select_related/prefetch_related dans le queryset'],
                            warnings: ['Attention aux performances avec beaucoup de données imbriquées']
                        }
                    },
                    {
                        cmd: 'Créer/modifier des objets liés',
                        desc: 'Writable Nested Serializers',
                        details: {
                            explanation: 'Permet de créer/modifier des objets liés via le serializer parent.',
                            syntax: 'def create(self, validated_data): ...',
                            options: [
                                { flag: 'create()', desc: 'Logique de création' },
                                { flag: 'update()', desc: 'Logique de mise à jour' },
                                { flag: 'validated_data.pop()', desc: 'Extraire les données imbriquées' }
                            ],
                            examples: [
                                { code: 'class PostSerializer(serializers.ModelSerializer):\n    tags = TagSerializer(many=True)\n    \n    class Meta:\n        model = Post\n        fields = ["id", "title", "content", "tags"]\n    \n    def create(self, validated_data):\n        tags_data = validated_data.pop("tags", [])\n        post = Post.objects.create(**validated_data)\n        for tag_data in tags_data:\n            tag, _ = Tag.objects.get_or_create(**tag_data)\n            post.tags.add(tag)\n        return post\n    \n    def update(self, instance, validated_data):\n        tags_data = validated_data.pop("tags", None)\n        \n        for attr, value in validated_data.items():\n            setattr(instance, attr, value)\n        instance.save()\n        \n        if tags_data is not None:\n            instance.tags.clear()\n            for tag_data in tags_data:\n                tag, _ = Tag.objects.get_or_create(**tag_data)\n                instance.tags.add(tag)\n        \n        return instance', desc: 'Writable nested' },
                                { code: '# Requête POST\n{\n    "title": "Nouvel article",\n    "content": "...",\n    "tags": [\n        {"name": "python"},\n        {"name": "django"}\n    ]\n}', desc: 'Données d\'entrée' }
                            ],
                            tips: ['Utilisez get_or_create pour éviter les doublons'],
                            warnings: ['La logique peut devenir complexe, documentez bien']
                        }
                    },
                    {
                        cmd: 'Ajouter une validation personnalisée',
                        desc: 'validate_field et validate()',
                        details: {
                            explanation: 'Ajoute des règles de validation au serializer.',
                            syntax: 'def validate_field(self, value): ...',
                            options: [
                                { flag: 'validate_<field>', desc: 'Valider un champ' },
                                { flag: 'validate()', desc: 'Validation globale' },
                                { flag: 'validators', desc: 'Validateurs sur le champ' }
                            ],
                            examples: [
                                { code: 'class PostSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = Post\n        fields = ["id", "title", "content", "status"]\n    \n    def validate_title(self, value):\n        if len(value) < 5:\n            raise serializers.ValidationError(\n                "Le titre doit faire au moins 5 caractères"\n            )\n        if Post.objects.filter(title=value).exists():\n            raise serializers.ValidationError(\n                "Un article avec ce titre existe déjà"\n            )\n        return value', desc: 'Validation de champ' },
                                { code: 'def validate(self, data):\n    """\n    Validation croisée entre champs.\n    """\n    if data.get("status") == "published":\n        if len(data.get("content", "")) < 100:\n            raise serializers.ValidationError({\n                "content": "Le contenu doit faire au moins 100 caractères pour être publié"\n            })\n    return data', desc: 'Validation globale' },
                                { code: '# Avec validators\nfrom rest_framework.validators import UniqueValidator\n\nclass PostSerializer(serializers.ModelSerializer):\n    title = serializers.CharField(\n        max_length=200,\n        validators=[\n            UniqueValidator(queryset=Post.objects.all())\n        ]\n    )', desc: 'Validators' }
                            ],
                            tips: ['Retournez toujours la valeur dans validate_<field>'],
                            warnings: ['ValidationError avec dict pour erreurs par champ']
                        }
                    },
                    {
                        cmd: 'Utiliser différents serializers selon l\'action',
                        desc: 'get_serializer_class() dynamique',
                        details: {
                            explanation: 'Utilise différents serializers selon l\'action (list, create, etc.).',
                            syntax: 'def get_serializer_class(self): ...',
                            options: [
                                { flag: 'self.action', desc: 'Action en cours (list, create, retrieve...)' },
                                { flag: 'self.request.method', desc: 'Méthode HTTP' }
                            ],
                            examples: [
                                { code: 'class PostListSerializer(serializers.ModelSerializer):\n    """Serializer léger pour les listes"""\n    class Meta:\n        model = Post\n        fields = ["id", "title", "author", "created"]\n\nclass PostDetailSerializer(serializers.ModelSerializer):\n    """Serializer complet pour le détail"""\n    author = AuthorSerializer(read_only=True)\n    comments = CommentSerializer(many=True, read_only=True)\n    \n    class Meta:\n        model = Post\n        fields = ["id", "title", "content", "author", "comments", "created"]\n\nclass PostCreateSerializer(serializers.ModelSerializer):\n    """Serializer pour la création"""\n    class Meta:\n        model = Post\n        fields = ["title", "content", "status"]', desc: 'Serializers spécialisés' },
                                { code: 'class PostViewSet(viewsets.ModelViewSet):\n    queryset = Post.objects.all()\n    \n    def get_serializer_class(self):\n        if self.action == "list":\n            return PostListSerializer\n        elif self.action == "create":\n            return PostCreateSerializer\n        return PostDetailSerializer', desc: 'Sélection dynamique' }
                            ],
                            tips: ['Serializer léger pour list améliore les performances'],
                            warnings: ['Documentez bien quel serializer est utilisé où']
                        }
                    },
                    {
                        cmd: 'Accéder au contexte',
                        desc: 'self.context[\'request\'] pour l\'utilisateur',
                        details: {
                            explanation: 'Accède à request, view et autres données dans le serializer.',
                            syntax: 'self.context["request"]',
                            options: [
                                { flag: 'self.context["request"]', desc: 'Requête HTTP' },
                                { flag: 'self.context["view"]', desc: 'Vue en cours' },
                                { flag: 'self.context["format"]', desc: 'Format de sortie' }
                            ],
                            examples: [
                                { code: 'class PostSerializer(serializers.ModelSerializer):\n    is_owner = serializers.SerializerMethodField()\n    \n    class Meta:\n        model = Post\n        fields = ["id", "title", "content", "is_owner"]\n    \n    def get_is_owner(self, obj):\n        request = self.context.get("request")\n        if request and request.user.is_authenticated:\n            return obj.author == request.user\n        return False', desc: 'Accès à request' },
                                { code: 'class PostSerializer(serializers.ModelSerializer):\n    url = serializers.SerializerMethodField()\n    \n    def get_url(self, obj):\n        request = self.context.get("request")\n        return request.build_absolute_uri(obj.get_absolute_url())\n    \n    def create(self, validated_data):\n        # Ajouter l\'auteur automatiquement\n        validated_data["author"] = self.context["request"].user\n        return super().create(validated_data)', desc: 'URL absolue et auteur auto' }
                            ],
                            tips: ['Le contexte est passé automatiquement par les ViewSets'],
                            warnings: ['Vérifiez que request existe (peut être None dans certains cas)']
                        }
                    }
                ]
            },
            {
                id: 'protect-api',
                title: 'Protéger mon API',
                icon: 'fa-shield-alt',
                color: 'border-l-4 border-orange-500',
                commands: [
                    {
                        cmd: 'Limiter le nombre de requêtes',
                        desc: 'Throttling global',
                        details: {
                            explanation: 'Limite le nombre de requêtes par utilisateur/IP.',
                            syntax: 'DEFAULT_THROTTLE_RATES',
                            options: [
                                { flag: 'AnonRateThrottle', desc: 'Pour utilisateurs anonymes' },
                                { flag: 'UserRateThrottle', desc: 'Pour utilisateurs authentifiés' },
                                { flag: 'second/minute/hour/day', desc: 'Unités de temps' }
                            ],
                            examples: [
                                { code: '# settings.py\nREST_FRAMEWORK = {\n    "DEFAULT_THROTTLE_CLASSES": [\n        "rest_framework.throttling.AnonRateThrottle",\n        "rest_framework.throttling.UserRateThrottle",\n    ],\n    "DEFAULT_THROTTLE_RATES": {\n        "anon": "100/day",\n        "user": "1000/day",\n    }\n}', desc: 'Configuration globale' },
                                { code: '# Par vue\nfrom rest_framework.throttling import UserRateThrottle\n\nclass BurstRateThrottle(UserRateThrottle):\n    rate = "60/minute"\n\nclass PostViewSet(viewsets.ModelViewSet):\n    throttle_classes = [BurstRateThrottle]', desc: 'Par vue' }
                            ],
                            tips: ['Utilisez des limites différentes pour anon et user'],
                            warnings: ['Le throttling basé sur IP peut bloquer des proxies']
                        }
                    },
                    {
                        cmd: 'Appliquer des limites par endpoint',
                        desc: 'ScopedRateThrottle pour limites spécifiques',
                        details: {
                            explanation: 'Applique des limites différentes selon les scopes.',
                            syntax: 'throttle_scope = "scope_name"',
                            options: [
                                { flag: 'ScopedRateThrottle', desc: 'Throttle par scope' },
                                { flag: 'throttle_scope', desc: 'Définir le scope de la vue' }
                            ],
                            examples: [
                                { code: '# settings.py\nREST_FRAMEWORK = {\n    "DEFAULT_THROTTLE_CLASSES": [\n        "rest_framework.throttling.ScopedRateThrottle",\n    ],\n    "DEFAULT_THROTTLE_RATES": {\n        "posts": "100/hour",\n        "comments": "50/hour",\n        "uploads": "10/hour",\n    }\n}', desc: 'Configuration des scopes' },
                                { code: '# views.py\nclass PostViewSet(viewsets.ModelViewSet):\n    throttle_scope = "posts"\n\nclass CommentViewSet(viewsets.ModelViewSet):\n    throttle_scope = "comments"\n\nclass UploadView(APIView):\n    throttle_scope = "uploads"', desc: 'Application par vue' }
                            ],
                            tips: ['Utile pour limiter les uploads ou opérations coûteuses'],
                            warnings: ['Définissez bien les rates pour chaque scope']
                        }
                    },
                    {
                        cmd: 'Créer un throttle personnalisé',
                        desc: 'BaseThrottle pour logique métier',
                        details: {
                            explanation: 'Crée un throttle avec une logique personnalisée.',
                            syntax: 'class MyThrottle(BaseThrottle): ...',
                            options: [
                                { flag: 'allow_request()', desc: 'Retourne True/False' },
                                { flag: 'wait()', desc: 'Temps d\'attente' }
                            ],
                            examples: [
                                { code: 'from rest_framework.throttling import BaseThrottle\nimport time\n\nclass OncePerMinuteThrottle(BaseThrottle):\n    """\n    Limite à une requête par minute par utilisateur.\n    """\n    cache = {}\n    \n    def allow_request(self, request, view):\n        if not request.user.is_authenticated:\n            return True\n        \n        user_id = request.user.id\n        now = time.time()\n        \n        if user_id in self.cache:\n            last_request = self.cache[user_id]\n            if now - last_request < 60:\n                self.wait_time = 60 - (now - last_request)\n                return False\n        \n        self.cache[user_id] = now\n        return True\n    \n    def wait(self):\n        return getattr(self, "wait_time", 60)', desc: 'Throttle personnalisé' }
                            ],
                            tips: ['Utilisez le cache Django pour la production'],
                            warnings: ['Ce code simplifié n\'est pas thread-safe']
                        }
                    },
                    {
                        cmd: 'Gérer les quotas selon le plan utilisateur',
                        desc: 'Custom throttle par plan',
                        details: {
                            explanation: 'Applique des limites différentes selon le plan de l\'utilisateur.',
                            syntax: 'Surcharger get_rate()',
                            options: [
                                { flag: 'get_rate()', desc: 'Retourne le rate pour l\'utilisateur' }
                            ],
                            examples: [
                                { code: 'from rest_framework.throttling import UserRateThrottle\n\nclass PlanBasedThrottle(UserRateThrottle):\n    """\n    Limites selon le plan utilisateur.\n    """\n    PLAN_RATES = {\n        "free": "100/day",\n        "basic": "1000/day",\n        "premium": "10000/day",\n        "enterprise": None,  # Illimité\n    }\n    \n    def get_rate(self):\n        if not self.request.user.is_authenticated:\n            return "50/day"\n        \n        plan = getattr(self.request.user, "plan", "free")\n        return self.PLAN_RATES.get(plan, "100/day")\n    \n    def allow_request(self, request, view):\n        self.request = request\n        rate = self.get_rate()\n        if rate is None:\n            return True  # Illimité\n        return super().allow_request(request, view)', desc: 'Throttle par plan' },
                                { code: '# Utilisation\nclass PostViewSet(viewsets.ModelViewSet):\n    throttle_classes = [PlanBasedThrottle]', desc: 'Application' }
                            ],
                            tips: ['Stockez le plan dans le profil utilisateur'],
                            warnings: ['Testez bien les transitions de plan']
                        }
                    }
                ]
            },
            {
                id: 'handle-errors',
                title: 'Gérer les Erreurs',
                icon: 'fa-exclamation-triangle',
                color: 'border-l-4 border-red-400',
                commands: [
                    {
                        cmd: 'Lever des exceptions API standards',
                        desc: 'ValidationError, NotFound, etc.',
                        details: {
                            explanation: 'Utilise les exceptions DRF pour des réponses d\'erreur cohérentes.',
                            syntax: 'raise ValidationError("message")',
                            options: [
                                { flag: 'ValidationError', desc: '400 Bad Request' },
                                { flag: 'NotFound', desc: '404 Not Found' },
                                { flag: 'PermissionDenied', desc: '403 Forbidden' },
                                { flag: 'NotAuthenticated', desc: '401 Unauthorized' },
                                { flag: 'Throttled', desc: '429 Too Many Requests' }
                            ],
                            examples: [
                                { code: 'from rest_framework.exceptions import (\n    ValidationError,\n    NotFound,\n    PermissionDenied,\n    NotAuthenticated\n)\n\nclass PostViewSet(viewsets.ModelViewSet):\n    def perform_create(self, serializer):\n        if self.request.user.posts.count() >= 100:\n            raise ValidationError(\n                "Limite de 100 posts atteinte"\n            )\n        serializer.save(author=self.request.user)\n    \n    def get_object(self):\n        try:\n            return super().get_object()\n        except Post.DoesNotExist:\n            raise NotFound("Article non trouvé")', desc: 'Exceptions courantes' },
                                { code: '# Réponse automatique\n# {\n#   "detail": "Limite de 100 posts atteinte"\n# }\n# Status: 400 Bad Request', desc: 'Format de réponse' }
                            ],
                            tips: ['DRF convertit automatiquement les exceptions en réponses JSON'],
                            warnings: ['Utilisez ValidationError avec un dict pour les erreurs de champs']
                        }
                    },
                    {
                        cmd: 'Créer des exceptions personnalisées',
                        desc: 'APIException subclass',
                        details: {
                            explanation: 'Crée des exceptions personnalisées pour des cas spécifiques.',
                            syntax: 'class MyException(APIException): ...',
                            options: [
                                { flag: 'status_code', desc: 'Code HTTP' },
                                { flag: 'default_detail', desc: 'Message par défaut' },
                                { flag: 'default_code', desc: 'Code d\'erreur' }
                            ],
                            examples: [
                                { code: 'from rest_framework.exceptions import APIException\nfrom rest_framework import status\n\nclass ServiceUnavailable(APIException):\n    status_code = status.HTTP_503_SERVICE_UNAVAILABLE\n    default_detail = "Service temporairement indisponible"\n    default_code = "service_unavailable"\n\nclass QuotaExceeded(APIException):\n    status_code = status.HTTP_429_TOO_MANY_REQUESTS\n    default_detail = "Quota dépassé"\n    default_code = "quota_exceeded"\n\nclass PaymentRequired(APIException):\n    status_code = 402\n    default_detail = "Paiement requis pour cette fonctionnalité"\n    default_code = "payment_required"', desc: 'Exceptions personnalisées' },
                                { code: '# Utilisation\nclass PremiumFeatureView(APIView):\n    def get(self, request):\n        if not request.user.is_premium:\n            raise PaymentRequired(\n                detail="Abonnement premium requis",\n                code="upgrade_required"\n            )\n        return Response({"data": "..."})', desc: 'Utilisation' }
                            ],
                            tips: ['Utilisez des codes d\'erreur explicites pour le frontend'],
                            warnings: ['Documentez vos codes d\'erreur dans l\'API']
                        }
                    },
                    {
                        cmd: 'Personnaliser le format des erreurs',
                        desc: 'EXCEPTION_HANDLER custom',
                        details: {
                            explanation: 'Personnalise le format JSON des erreurs.',
                            syntax: 'EXCEPTION_HANDLER = "path.to.handler"',
                            options: [
                                { flag: 'exception_handler', desc: 'Fonction de gestion' },
                                { flag: 'response.data', desc: 'Données de la réponse' }
                            ],
                            examples: [
                                { code: '# utils/exception_handler.py\nfrom rest_framework.views import exception_handler\nfrom rest_framework.exceptions import APIException\n\ndef custom_exception_handler(exc, context):\n    response = exception_handler(exc, context)\n    \n    if response is not None:\n        custom_response = {\n            "success": False,\n            "error": {\n                "code": getattr(exc, "default_code", "error"),\n                "message": response.data.get("detail", str(exc)),\n                "status": response.status_code,\n            }\n        }\n        \n        # Erreurs de validation (champs multiples)\n        if isinstance(response.data, dict) and "detail" not in response.data:\n            custom_response["error"]["fields"] = response.data\n        \n        response.data = custom_response\n    \n    return response', desc: 'Handler personnalisé' },
                                { code: '# settings.py\nREST_FRAMEWORK = {\n    "EXCEPTION_HANDLER": "utils.exception_handler.custom_exception_handler",\n}\n\n# Réponse :\n# {\n#   "success": false,\n#   "error": {\n#     "code": "validation_error",\n#     "message": "Invalid input",\n#     "status": 400,\n#     "fields": {"title": ["Ce champ est requis"]}\n#   }\n# }', desc: 'Configuration et résultat' }
                            ],
                            tips: ['Format cohérent = meilleure expérience développeur'],
                            warnings: ['Testez bien tous les types d\'erreurs']
                        }
                    },
                    {
                        cmd: 'Logger les erreurs en production',
                        desc: 'Custom exception handler avec logging',
                        details: {
                            explanation: 'Log les erreurs pour le debugging en production.',
                            syntax: 'logger.error(...)',
                            options: [
                                { flag: 'logging', desc: 'Module de logging Python' },
                                { flag: 'context', desc: 'Informations sur la requête' }
                            ],
                            examples: [
                                { code: 'import logging\nfrom rest_framework.views import exception_handler\n\nlogger = logging.getLogger(__name__)\n\ndef custom_exception_handler(exc, context):\n    response = exception_handler(exc, context)\n    \n    # Log les erreurs 500\n    if response is None or response.status_code >= 500:\n        request = context.get("request")\n        view = context.get("view")\n        \n        logger.error(\n            f"API Error: {exc.__class__.__name__}: {exc}",\n            exc_info=True,\n            extra={\n                "request_path": getattr(request, "path", None),\n                "request_method": getattr(request, "method", None),\n                "user": getattr(request.user, "id", None),\n                "view": view.__class__.__name__ if view else None,\n            }\n        )\n    \n    return response', desc: 'Logging des erreurs' },
                                { code: '# settings.py - Configuration logging\nLOGGING = {\n    "version": 1,\n    "handlers": {\n        "file": {\n            "class": "logging.FileHandler",\n            "filename": "api_errors.log",\n        },\n    },\n    "loggers": {\n        "api": {\n            "handlers": ["file"],\n            "level": "ERROR",\n        },\n    },\n}', desc: 'Configuration logging' }
                            ],
                            tips: ['Utilisez Sentry ou similaire en production'],
                            warnings: ['Ne loggez pas de données sensibles (passwords, tokens)']
                        }
                    }
                ]
            },
            {
                id: 'test-api',
                title: 'Tester mon API',
                icon: 'fa-vial',
                color: 'border-l-4 border-cyan-500',
                commands: [
                    {
                        cmd: 'Tester mes endpoints',
                        desc: 'APITestCase et APIClient',
                        details: {
                            explanation: 'Crée des tests automatisés pour les endpoints de l\'API.',
                            syntax: 'class MyTests(APITestCase): ...',
                            options: [
                                { flag: 'APITestCase', desc: 'Classe de test DRF' },
                                { flag: 'APIClient', desc: 'Client HTTP pour tests' },
                                { flag: 'self.client', desc: 'Client intégré' }
                            ],
                            examples: [
                                { code: 'from rest_framework.test import APITestCase\nfrom rest_framework import status\nfrom django.urls import reverse\nfrom .models import Post\nfrom django.contrib.auth.models import User\n\nclass PostAPITests(APITestCase):\n    def setUp(self):\n        self.user = User.objects.create_user(\n            username="testuser",\n            password="testpass"\n        )\n        self.post = Post.objects.create(\n            title="Test Post",\n            content="Test content",\n            author=self.user\n        )\n        self.url = reverse("post-list")\n    \n    def test_list_posts(self):\n        response = self.client.get(self.url)\n        self.assertEqual(response.status_code, status.HTTP_200_OK)\n        self.assertEqual(len(response.data["results"]), 1)\n    \n    def test_create_post_unauthenticated(self):\n        data = {"title": "New", "content": "Content"}\n        response = self.client.post(self.url, data)\n        self.assertEqual(response.status_code, status.HTTP_401_UNAUTHORIZED)', desc: 'Tests de base' }
                            ],
                            tips: ['Utilisez setUp pour créer les données de test'],
                            warnings: ['Chaque test doit être indépendant']
                        }
                    },
                    {
                        cmd: 'Simuler l\'authentification',
                        desc: 'force_authenticate() et credentials()',
                        details: {
                            explanation: 'Authentifie le client de test pour les requêtes protégées.',
                            syntax: 'self.client.force_authenticate(user=user)',
                            options: [
                                { flag: 'force_authenticate', desc: 'Auth directe sans login' },
                                { flag: 'credentials', desc: 'Ajouter des headers' },
                                { flag: 'login', desc: 'Login classique' }
                            ],
                            examples: [
                                { code: 'class PostAPITests(APITestCase):\n    def setUp(self):\n        self.user = User.objects.create_user(\n            username="testuser",\n            password="testpass"\n        )\n    \n    def test_create_post_authenticated(self):\n        # Méthode 1: force_authenticate\n        self.client.force_authenticate(user=self.user)\n        \n        data = {"title": "New Post", "content": "Content"}\n        response = self.client.post(\n            reverse("post-list"),\n            data,\n            format="json"\n        )\n        self.assertEqual(response.status_code, status.HTTP_201_CREATED)\n        self.assertEqual(Post.objects.count(), 1)\n        self.assertEqual(Post.objects.first().author, self.user)', desc: 'force_authenticate' },
                                { code: 'def test_with_token(self):\n    # Méthode 2: Avec token\n    from rest_framework.authtoken.models import Token\n    token = Token.objects.create(user=self.user)\n    self.client.credentials(\n        HTTP_AUTHORIZATION=f"Token {token.key}"\n    )\n    \n    response = self.client.get(reverse("post-list"))\n    self.assertEqual(response.status_code, status.HTTP_200_OK)\n\ndef test_with_jwt(self):\n    # Méthode 3: Avec JWT\n    response = self.client.post(\n        reverse("token_obtain_pair"),\n        {"username": "testuser", "password": "testpass"}\n    )\n    token = response.data["access"]\n    self.client.credentials(\n        HTTP_AUTHORIZATION=f"Bearer {token}"\n    )', desc: 'Avec tokens' }
                            ],
                            tips: ['force_authenticate est le plus simple pour les tests'],
                            warnings: ['N\'oubliez pas de réinitialiser entre les tests']
                        }
                    },
                    {
                        cmd: 'Vérifier les réponses',
                        desc: 'status_code, response.data assertions',
                        details: {
                            explanation: 'Vérifie le contenu et le status des réponses API.',
                            syntax: 'self.assertEqual(response.status_code, ...)',
                            options: [
                                { flag: 'response.status_code', desc: 'Code HTTP' },
                                { flag: 'response.data', desc: 'Données JSON' },
                                { flag: 'response.json()', desc: 'Alternative pour JSON' }
                            ],
                            examples: [
                                { code: 'def test_get_post_detail(self):\n    url = reverse("post-detail", args=[self.post.id])\n    response = self.client.get(url)\n    \n    # Vérifier le status\n    self.assertEqual(response.status_code, status.HTTP_200_OK)\n    \n    # Vérifier les données\n    self.assertEqual(response.data["title"], "Test Post")\n    self.assertEqual(response.data["author"], self.user.id)\n    \n    # Vérifier la structure\n    self.assertIn("id", response.data)\n    self.assertIn("created", response.data)\n    self.assertNotIn("password", response.data)', desc: 'Vérification complète' },
                                { code: 'def test_validation_errors(self):\n    self.client.force_authenticate(user=self.user)\n    \n    # Données invalides\n    data = {"title": "", "content": ""}\n    response = self.client.post(\n        reverse("post-list"),\n        data,\n        format="json"\n    )\n    \n    self.assertEqual(response.status_code, status.HTTP_400_BAD_REQUEST)\n    self.assertIn("title", response.data)\n    self.assertIn("content", response.data)', desc: 'Tester les erreurs' }
                            ],
                            tips: ['Vérifiez aussi ce qui ne doit PAS être dans la réponse'],
                            warnings: ['response.data est déjà désérialisé (dict/list)']
                        }
                    },
                    {
                        cmd: 'Tester les vues isolément',
                        desc: 'APIRequestFactory pour tests unitaires',
                        details: {
                            explanation: 'Teste les vues de manière isolée sans passer par les URLs.',
                            syntax: 'factory = APIRequestFactory()',
                            options: [
                                { flag: 'APIRequestFactory', desc: 'Crée des requêtes mock' },
                                { flag: 'force_authenticate', desc: 'Auth sur la requête' }
                            ],
                            examples: [
                                { code: 'from rest_framework.test import APIRequestFactory\nfrom .views import PostViewSet\n\nclass PostViewSetTests(APITestCase):\n    def setUp(self):\n        self.factory = APIRequestFactory()\n        self.user = User.objects.create_user(\n            username="testuser",\n            password="testpass"\n        )\n        self.view = PostViewSet.as_view({"get": "list", "post": "create"})\n    \n    def test_list_posts(self):\n        request = self.factory.get("/api/posts/")\n        request.user = self.user\n        \n        response = self.view(request)\n        self.assertEqual(response.status_code, status.HTTP_200_OK)\n    \n    def test_create_post(self):\n        data = {"title": "New", "content": "Content"}\n        request = self.factory.post(\n            "/api/posts/",\n            data,\n            format="json"\n        )\n        force_authenticate(request, user=self.user)\n        \n        response = self.view(request)\n        self.assertEqual(response.status_code, status.HTTP_201_CREATED)', desc: 'Tests avec Factory' }
                            ],
                            tips: ['Plus rapide que APIClient car ne passe pas par les middlewares'],
                            warnings: ['Les URLs dans factory sont ignorées (utilisées juste pour le chemin)']
                        }
                    },
                    {
                        cmd: 'Tester les cas d\'erreur',
                        desc: '400, 401, 403, 404 assertions',
                        details: {
                            explanation: 'Teste les différents cas d\'erreur de l\'API.',
                            syntax: 'self.assertEqual(response.status_code, 404)',
                            options: [
                                { flag: '400', desc: 'Bad Request (validation)' },
                                { flag: '401', desc: 'Unauthorized' },
                                { flag: '403', desc: 'Forbidden' },
                                { flag: '404', desc: 'Not Found' }
                            ],
                            examples: [
                                { code: 'class ErrorHandlingTests(APITestCase):\n    def setUp(self):\n        self.user = User.objects.create_user("user", password="pass")\n        self.other_user = User.objects.create_user("other", password="pass")\n        self.post = Post.objects.create(\n            title="Test",\n            content="Content",\n            author=self.user\n        )\n    \n    def test_401_unauthenticated(self):\n        response = self.client.post(\n            reverse("post-list"),\n            {"title": "New"}\n        )\n        self.assertEqual(response.status_code, status.HTTP_401_UNAUTHORIZED)\n    \n    def test_403_not_owner(self):\n        self.client.force_authenticate(user=self.other_user)\n        response = self.client.delete(\n            reverse("post-detail", args=[self.post.id])\n        )\n        self.assertEqual(response.status_code, status.HTTP_403_FORBIDDEN)\n    \n    def test_404_not_found(self):\n        self.client.force_authenticate(user=self.user)\n        response = self.client.get(\n            reverse("post-detail", args=[99999])\n        )\n        self.assertEqual(response.status_code, status.HTTP_404_NOT_FOUND)', desc: 'Tests d\'erreurs' }
                            ],
                            tips: ['Testez TOUS les cas d\'erreur possibles'],
                            warnings: ['Les tests d\'erreur sont aussi importants que les tests de succès']
                        }
                    }
                ]
            },
            {
                id: 'project-api',
                title: 'Projet: API Blog Complet',
                icon: 'fa-server',
                color: 'border-l-4 border-lime-500',
                commands: [
                    {
                        cmd: 'Étape 1: Structure du projet',
                        desc: 'Organisation des apps et settings',
                        details: {
                            explanation: 'Crée la structure du projet Django avec DRF.',
                            syntax: 'Structure de fichiers recommandée',
                            options: [],
                            examples: [
                                { code: '# Structure du projet\nblog_api/\n├── config/\n│   ├── __init__.py\n│   ├── settings.py\n│   ├── urls.py\n│   └── wsgi.py\n├── api/\n│   ├── __init__.py\n│   ├── models.py\n│   ├── serializers.py\n│   ├── views.py\n│   ├── urls.py\n│   ├── permissions.py\n│   └── tests/\n│       ├── __init__.py\n│       ├── test_posts.py\n│       └── test_comments.py\n├── manage.py\n└── requirements.txt', desc: 'Structure de fichiers' },
                                { code: '# requirements.txt\nDjango>=4.2\ndjangorestframework>=3.14\ndjangorestframework-simplejwt>=5.3\ndjango-filter>=23.0\ndjango-cors-headers>=4.0', desc: 'Dépendances' }
                            ],
                            tips: ['Séparez les tests par module'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Étape 2: Modèles',
                        desc: 'Post, Comment, Category',
                        details: {
                            explanation: 'Définit les modèles pour le blog.',
                            syntax: 'class Post(models.Model): ...',
                            options: [],
                            examples: [
                                { code: '# api/models.py\nfrom django.db import models\nfrom django.contrib.auth.models import User\n\nclass Category(models.Model):\n    name = models.CharField(max_length=100, unique=True)\n    slug = models.SlugField(unique=True)\n    \n    class Meta:\n        verbose_name_plural = "categories"\n    \n    def __str__(self):\n        return self.name\n\nclass Post(models.Model):\n    STATUS_CHOICES = [\n        ("draft", "Brouillon"),\n        ("published", "Publié"),\n    ]\n    \n    title = models.CharField(max_length=200)\n    slug = models.SlugField(unique=True)\n    content = models.TextField()\n    author = models.ForeignKey(User, on_delete=models.CASCADE, related_name="posts")\n    category = models.ForeignKey(Category, on_delete=models.SET_NULL, null=True, related_name="posts")\n    status = models.CharField(max_length=10, choices=STATUS_CHOICES, default="draft")\n    created = models.DateTimeField(auto_now_add=True)\n    updated = models.DateTimeField(auto_now=True)\n    \n    class Meta:\n        ordering = ["-created"]\n    \n    def __str__(self):\n        return self.title', desc: 'Modèle Post' },
                                { code: 'class Comment(models.Model):\n    post = models.ForeignKey(Post, on_delete=models.CASCADE, related_name="comments")\n    author = models.ForeignKey(User, on_delete=models.CASCADE, related_name="comments")\n    content = models.TextField()\n    created = models.DateTimeField(auto_now_add=True)\n    \n    class Meta:\n        ordering = ["created"]\n    \n    def __str__(self):\n        return f"Comment by {self.author} on {self.post}"', desc: 'Modèle Comment' }
                            ],
                            tips: ['Utilisez related_name pour les requêtes inverses'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Étape 3: Serializers',
                        desc: 'PostSerializer avec nested',
                        details: {
                            explanation: 'Crée les serializers pour l\'API.',
                            syntax: 'class PostSerializer(serializers.ModelSerializer): ...',
                            options: [],
                            examples: [
                                { code: '# api/serializers.py\nfrom rest_framework import serializers\nfrom django.contrib.auth.models import User\nfrom .models import Post, Comment, Category\n\nclass UserSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = User\n        fields = ["id", "username", "email"]\n\nclass CategorySerializer(serializers.ModelSerializer):\n    class Meta:\n        model = Category\n        fields = ["id", "name", "slug"]\n\nclass CommentSerializer(serializers.ModelSerializer):\n    author = UserSerializer(read_only=True)\n    \n    class Meta:\n        model = Comment\n        fields = ["id", "author", "content", "created"]\n        read_only_fields = ["id", "created"]', desc: 'Serializers de base' },
                                { code: 'class PostListSerializer(serializers.ModelSerializer):\n    author = UserSerializer(read_only=True)\n    category = CategorySerializer(read_only=True)\n    comments_count = serializers.SerializerMethodField()\n    \n    class Meta:\n        model = Post\n        fields = ["id", "title", "slug", "author", "category", "status", "created", "comments_count"]\n    \n    def get_comments_count(self, obj):\n        return obj.comments.count()\n\nclass PostDetailSerializer(serializers.ModelSerializer):\n    author = UserSerializer(read_only=True)\n    category = CategorySerializer(read_only=True)\n    comments = CommentSerializer(many=True, read_only=True)\n    \n    class Meta:\n        model = Post\n        fields = ["id", "title", "slug", "content", "author", "category", "status", "created", "updated", "comments"]\n\nclass PostCreateSerializer(serializers.ModelSerializer):\n    class Meta:\n        model = Post\n        fields = ["title", "slug", "content", "category", "status"]', desc: 'Serializers Post' }
                            ],
                            tips: ['Serializers différents pour list/detail/create'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Étape 4: ViewSets et Permissions',
                        desc: 'ModelViewSet avec IsOwnerOrReadOnly',
                        details: {
                            explanation: 'Crée les vues avec permissions.',
                            syntax: 'class PostViewSet(viewsets.ModelViewSet): ...',
                            options: [],
                            examples: [
                                { code: '# api/permissions.py\nfrom rest_framework.permissions import BasePermission, SAFE_METHODS\n\nclass IsOwnerOrReadOnly(BasePermission):\n    def has_object_permission(self, request, view, obj):\n        if request.method in SAFE_METHODS:\n            return True\n        return obj.author == request.user', desc: 'Permission personnalisée' },
                                { code: '# api/views.py\nfrom rest_framework import viewsets, status\nfrom rest_framework.decorators import action\nfrom rest_framework.response import Response\nfrom rest_framework.permissions import IsAuthenticatedOrReadOnly\nfrom django_filters.rest_framework import DjangoFilterBackend\nfrom rest_framework.filters import SearchFilter, OrderingFilter\n\nfrom .models import Post, Comment, Category\nfrom .serializers import *\nfrom .permissions import IsOwnerOrReadOnly\n\nclass PostViewSet(viewsets.ModelViewSet):\n    queryset = Post.objects.select_related("author", "category").prefetch_related("comments")\n    permission_classes = [IsAuthenticatedOrReadOnly, IsOwnerOrReadOnly]\n    filter_backends = [DjangoFilterBackend, SearchFilter, OrderingFilter]\n    filterset_fields = ["status", "category", "author"]\n    search_fields = ["title", "content"]\n    ordering_fields = ["created", "title"]\n    lookup_field = "slug"\n    \n    def get_serializer_class(self):\n        if self.action == "list":\n            return PostListSerializer\n        if self.action in ["create", "update", "partial_update"]:\n            return PostCreateSerializer\n        return PostDetailSerializer\n    \n    def perform_create(self, serializer):\n        serializer.save(author=self.request.user)\n    \n    @action(detail=True, methods=["post"])\n    def publish(self, request, slug=None):\n        post = self.get_object()\n        post.status = "published"\n        post.save()\n        return Response({"status": "published"})', desc: 'ViewSet complet' }
                            ],
                            tips: ['Optimisez avec select_related/prefetch_related'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Étape 5: Authentification JWT',
                        desc: 'SimpleJWT configuration',
                        details: {
                            explanation: 'Configure l\'authentification JWT.',
                            syntax: 'SIMPLE_JWT = { ... }',
                            options: [],
                            examples: [
                                { code: '# config/settings.py\nfrom datetime import timedelta\n\nINSTALLED_APPS = [\n    ...\n    "rest_framework",\n    "rest_framework_simplejwt",\n    "django_filters",\n    "corsheaders",\n    "api",\n]\n\nREST_FRAMEWORK = {\n    "DEFAULT_AUTHENTICATION_CLASSES": [\n        "rest_framework_simplejwt.authentication.JWTAuthentication",\n    ],\n    "DEFAULT_PERMISSION_CLASSES": [\n        "rest_framework.permissions.IsAuthenticatedOrReadOnly",\n    ],\n    "DEFAULT_PAGINATION_CLASS": "rest_framework.pagination.PageNumberPagination",\n    "PAGE_SIZE": 10,\n}\n\nSIMPLE_JWT = {\n    "ACCESS_TOKEN_LIFETIME": timedelta(minutes=30),\n    "REFRESH_TOKEN_LIFETIME": timedelta(days=7),\n    "ROTATE_REFRESH_TOKENS": True,\n}', desc: 'Configuration settings.py' },
                                { code: '# config/urls.py\nfrom django.contrib import admin\nfrom django.urls import path, include\nfrom rest_framework.routers import DefaultRouter\nfrom rest_framework_simplejwt.views import TokenObtainPairView, TokenRefreshView\nfrom api.views import PostViewSet, CommentViewSet, CategoryViewSet\n\nrouter = DefaultRouter()\nrouter.register("posts", PostViewSet, basename="post")\nrouter.register("comments", CommentViewSet, basename="comment")\nrouter.register("categories", CategoryViewSet, basename="category")\n\nurlpatterns = [\n    path("admin/", admin.site.urls),\n    path("api/", include(router.urls)),\n    path("api/token/", TokenObtainPairView.as_view()),\n    path("api/token/refresh/", TokenRefreshView.as_view()),\n]', desc: 'Configuration URLs' }
                            ],
                            tips: ['Ajoutez aussi un endpoint de register'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Étape 6: Tests automatisés',
                        desc: 'APITestCase avec coverage',
                        details: {
                            explanation: 'Écrit les tests pour l\'API.',
                            syntax: 'class PostTests(APITestCase): ...',
                            options: [],
                            examples: [
                                { code: '# api/tests/test_posts.py\nfrom rest_framework.test import APITestCase\nfrom rest_framework import status\nfrom django.urls import reverse\nfrom django.contrib.auth.models import User\nfrom api.models import Post, Category\n\nclass PostAPITests(APITestCase):\n    def setUp(self):\n        self.user = User.objects.create_user("testuser", password="testpass")\n        self.category = Category.objects.create(name="Tech", slug="tech")\n        self.post = Post.objects.create(\n            title="Test Post",\n            slug="test-post",\n            content="Test content",\n            author=self.user,\n            category=self.category,\n            status="published"\n        )\n    \n    def test_list_posts(self):\n        response = self.client.get(reverse("post-list"))\n        self.assertEqual(response.status_code, status.HTTP_200_OK)\n        self.assertEqual(len(response.data["results"]), 1)\n    \n    def test_create_post_authenticated(self):\n        self.client.force_authenticate(user=self.user)\n        data = {\n            "title": "New Post",\n            "slug": "new-post",\n            "content": "Content here",\n            "status": "draft"\n        }\n        response = self.client.post(reverse("post-list"), data)\n        self.assertEqual(response.status_code, status.HTTP_201_CREATED)\n        self.assertEqual(Post.objects.count(), 2)\n    \n    def test_update_own_post(self):\n        self.client.force_authenticate(user=self.user)\n        url = reverse("post-detail", args=[self.post.slug])\n        response = self.client.patch(url, {"title": "Updated"})\n        self.assertEqual(response.status_code, status.HTTP_200_OK)\n    \n    def test_delete_other_user_post_forbidden(self):\n        other_user = User.objects.create_user("other", password="pass")\n        self.client.force_authenticate(user=other_user)\n        url = reverse("post-detail", args=[self.post.slug])\n        response = self.client.delete(url)\n        self.assertEqual(response.status_code, status.HTTP_403_FORBIDDEN)', desc: 'Tests complets' },
                                { code: '# Lancer les tests avec coverage\n# pip install coverage\n# coverage run manage.py test\n# coverage report\n# coverage html', desc: 'Coverage' }
                            ],
                            tips: ['Visez 80%+ de coverage'],
                            warnings: []
                        }
                    },
                    {
                        cmd: 'Étape 7: Documentation OpenAPI',
                        desc: 'drf-spectacular pour Swagger',
                        details: {
                            explanation: 'Génère la documentation OpenAPI automatiquement.',
                            syntax: 'pip install drf-spectacular',
                            options: [],
                            examples: [
                                { code: '# Installation\npip install drf-spectacular\n\n# settings.py\nINSTALLED_APPS = [\n    ...\n    "drf_spectacular",\n]\n\nREST_FRAMEWORK = {\n    ...\n    "DEFAULT_SCHEMA_CLASS": "drf_spectacular.openapi.AutoSchema",\n}\n\nSPECTACULAR_SETTINGS = {\n    "TITLE": "Blog API",\n    "DESCRIPTION": "API pour le blog Django",\n    "VERSION": "1.0.0",\n    "SERVE_INCLUDE_SCHEMA": False,\n}', desc: 'Configuration' },
                                { code: '# urls.py\nfrom drf_spectacular.views import (\n    SpectacularAPIView,\n    SpectacularSwaggerView,\n    SpectacularRedocView,\n)\n\nurlpatterns = [\n    ...\n    # Documentation\n    path("api/schema/", SpectacularAPIView.as_view(), name="schema"),\n    path("api/docs/", SpectacularSwaggerView.as_view(url_name="schema"), name="swagger-ui"),\n    path("api/redoc/", SpectacularRedocView.as_view(url_name="schema"), name="redoc"),\n]\n\n# Accès :\n# /api/docs/ - Swagger UI\n# /api/redoc/ - ReDoc\n# /api/schema/ - OpenAPI JSON', desc: 'URLs documentation' }
                            ],
                            tips: ['Documentez vos endpoints avec des docstrings'],
                            warnings: ['Protégez /api/schema/ en production si API privée']
                        }
                    }
                ]
            }
        ];
    </script>
    <script src="../js/cheatsheet.js"></script>
</body>
</html>
